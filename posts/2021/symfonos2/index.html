<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Vulnhub: Symfonos 2 :: ikuamike</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="" />
<meta name="keywords" content=", " />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://blog.ikuamike.io/posts/2021/symfonos2/" />




<link rel="stylesheet" href="https://blog.ikuamike.io/assets/style.css">

  <link rel="stylesheet" href="https://blog.ikuamike.io/assets/green.css">



<link rel="stylesheet" href="https://blog.ikuamike.io/style.css">


<link rel="apple-touch-icon" href="https://blog.ikuamike.io/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://blog.ikuamike.io/img/favicon/green.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Vulnhub: Symfonos 2">
<meta property="og:description" content="" />
<meta property="og:url" content="https://blog.ikuamike.io/posts/2021/symfonos2/" />
<meta property="og:site_name" content="ikuamike" />

  <meta property="og:image" content="https://blog.ikuamike.io/">

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2021-02-10 00:00:00 &#43;0000 UTC" />












</head>
<body class="green">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    &gt; cd ~
  </div>
</a>

    </div>
    
      <div class="menu-trigger">menu</div>
    
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About Me</a></li>
        
      
        
          <li><a href="/all-posts">All Posts</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Show more ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/webinars">Webinars</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About Me</a></li>
      
    
      
        <li><a href="/all-posts">All Posts</a></li>
      
    
      
        <li><a href="/tags">Tags</a></li>
      
    
      
        <li><a href="/webinars">Webinars</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://blog.ikuamike.io/posts/2021/symfonos2/">Vulnhub: Symfonos 2</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2021-02-10 
      </span>
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://blog.ikuamike.io/tags/intermediate/">Intermediate</a>&nbsp;
    
    #<a href="https://blog.ikuamike.io/tags/vulnhub/">Vulnhub</a>&nbsp;
    
    #<a href="https://blog.ikuamike.io/tags/oscp-prep/">OSCP Prep</a>&nbsp;
    
    #<a href="https://blog.ikuamike.io/tags/samba/">Samba</a>&nbsp;
    
    #<a href="https://blog.ikuamike.io/tags/proftpd/">ProFTPD</a>&nbsp;
    
    #<a href="https://blog.ikuamike.io/tags/cve-2015-3306/">CVE-2015-3306</a>&nbsp;
    
    #<a href="https://blog.ikuamike.io/tags/librenms/">LibreNMS</a>&nbsp;
    
    #<a href="https://blog.ikuamike.io/tags/cve-2018-20434/">CVE-2018-20434</a>&nbsp;
    
    #<a href="https://blog.ikuamike.io/tags/sudo/">Sudo</a>&nbsp;
    
    #<a href="https://blog.ikuamike.io/tags/mysql/">MySQL</a>&nbsp;
    
  </span>
  

  

  

  <div class="post-content">
    <img src="/img/symfonos1/symfonos1.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<table>
<thead>
<tr>
<th>Difficulty</th>
<th>Release Date</th>
<th>Author</th>
<th>Machine link</th>
</tr>
</thead>
<tbody>
<tr>
<td>Intermediate</td>
<td>18 July 2019</td>
<td>Zayotic</td>
<td><a href="https://vulnhub.com/entry/symfonos-2,331">https://vulnhub.com/entry/symfonos-2,331</a></td>
</tr>
</tbody>
</table>
<h1 id="summary">Summary</h1>
<p>This box had quite a good number of misconfigurations and vulnerabilities. Initial access was through copying a shadow
backup file to a smb share accessible anonymously using a file copy vulnerability in proftpd. Then lateral movement
and privilege escalation was achieved by exploiting rce a locally running librenms instance and finally abusing
sudo permissions on mysql to get root.</p>
<h1 id="reconnaissance">Reconnaissance</h1>
<pre><code>Nmap scan report for 192.168.191.129
Host is up (0.00028s latency).

PORT    STATE SERVICE     VERSION
21/tcp  open  ftp         ProFTPD 1.3.5
22/tcp  open  ssh         OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)
| ssh-hostkey:
|   2048 9d:f8:5f:87:20:e5:8c:fa:68:47:7d:71:62:08:ad:b9 (RSA)
|   256 04:2a:bb:06:56:ea:d1:93:1c:d2:78:0a:00:46:9d:85 (ECDSA)
|_  256 28:ad:ac:dc:7e:2a:1c:f6:4c:6b:47:f2:d6:22:5b:52 (ED25519)
80/tcp  open  http        WebFS httpd 1.21
|_http-server-header: webfs/1.21
|_http-title: Site doesn't have a title (text/html).
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)
Service Info: Host: SYMFONOS2; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 2h00m00s, deviation: 3h27m51s, median: 0s
|_nbstat: NetBIOS name: SYMFONOS2, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| smb-os-discovery:
|   OS: Windows 6.1 (Samba 4.5.16-Debian)
|   Computer name: symfonos2
|   NetBIOS computer name: SYMFONOS2\x00
|   Domain name: \x00
|   FQDN: symfonos2
|_  System time: 2021-01-25T07:02:21-06:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2021-01-25T13:02:21
|_  start_date: N/A
</code></pre><h1 id="enumeration">Enumeration</h1>
<h2 id="samba-139445">Samba (139/445)</h2>
<p>Running smbmap on the target we see we can access the <strong>anonymous</strong> share without credentials:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">smbmap -R -H 192.168.191.129
</code></pre></div>
  <img src="/img/symfonos2/smbmap.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<p>Using smbclient to download log.txt from the anonymous share.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">smbclient <span style="color:#ae81ff">\\\\</span>192.168.191.129<span style="color:#ae81ff">\\</span>anonymous -N -c <span style="color:#e6db74">&#39;get backups\log.txt log.txt&#39;</span>
</code></pre></div><p>From log.txt, we discover a backup of the shadow file is created in /var/backups/</p>

  <img src="/img/symfonos2/symfonos2-1.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<h2 id="ftp-21">FTP (21)</h2>
<p>Checking for known vulnerabilities of the proftp version using searchsploit, we find several.</p>

  <img src="/img/symfonos2/symfonos2-2.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<p>The command execution exploits available rely on creating a php file on the existing webserver that would be executed.
However, the web server is running <a href="https://github.com/ourway/webfsd">webfs</a> which only serves static content.</p>
<p>We can only take advantage of the file copy vulnerability. From log.txt, the smb configuration gives the location
of the anonymous share:</p>

  <img src="/img/symfonos2/symfonos2-3.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<p>We can exfiltrate information to the anonymous share by exploiting file copy on proftpd. Using the PoC shown here
<a href="https://www.exploit-db.com/exploits/36742,">https://www.exploit-db.com/exploits/36742,</a> let&rsquo;s get the shadow.bak file. You can either use netcat or telnet.
In this case I use netcat.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nc -vn 192.168.191.129 <span style="color:#ae81ff">21</span>
</code></pre></div>
  <img src="/img/symfonos2/symfonos2-4.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<p>Running smbmap command again we see that we have shadow.bak file.</p>

  <img src="/img/symfonos2/symfonos2-5.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<h2 id="shell-as-aeolus">Shell as aeolus</h2>
<p>After downloading the shadow file from the smb we can crack it with john and rockyou wordlist.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">john --wordlist<span style="color:#f92672">=</span>/usr/share/wordlists/rockyou.txt shadow.bak
</code></pre></div>
  <img src="/img/symfonos2/symfonos2-6.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<p>Using sergioteamo as the password we can access ssh as aeolus.</p>
<p>Doing some basic manual enumeration, we see some ports listening on localhost.</p>

  <img src="/img/symfonos2/symfonos2-7.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<p>8080 would most likely be a webserver, so I&rsquo;ll tunnel to it first using an ssh port forward.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ssh -L 8000:127.0.0.1:8080 aeolus@192.168.191.129
</code></pre></div><p>When we visit http://127.0.0.1:8000 on the browser, we find that LibreNMS is running here.</p>

  <img src="/img/symfonos2/symfonos2-8.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<p>Using searchsploit again we find two existing vulnerabilities for version 1.46.</p>

  <img src="/img/symfonos2/symfonos2-13.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<p>Since we can&rsquo;t verify the version of librenms currently running, we&rsquo;ll try the exploits and see if they work. I&rsquo;ll go for the RCE.</p>
<p>Using the exploit script provided here <a href="https://www.exploit-db.com/exploits/47044,">https://www.exploit-db.com/exploits/47044,</a> we need to provide url, session cookies,
rhost and rport where the reverse shell will be received.</p>
<p>Login using the earlier discovered credentials <strong>aeolus : sergioteamo</strong>, then retrieve the cookies using burpsuite.</p>

  <img src="/img/symfonos2/symfonos2-10.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<p>Run the exploit as below and catch the reverse shell using netcat.</p>

  <img src="/img/symfonos2/symfonos2-11.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<p>We are now the cronus user.</p>
<h2 id="getting-a-root-shell">Getting a root shell</h2>
<p>Running sudo -l reveals cronus can run mysql as root with no password.</p>
<p>Dropping into mysql as root user, we can get a root shell using the below command.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#ae81ff">\!</span> bash
</code></pre></div>
  <img src="/img/symfonos2/symfonos2-12.png"  alt="symfonos"  class="center"  style="border-radius: 8px;"  />


<p>You can reach/follow me on Twitter if you have some feedback or questions.</p>
<p>Twitter: <a href="https://twitter.com/ikuamike">ikuamike</a></p>
<p>Github: <a href="https://github.com/ikuamike">ikuamike</a></p>
  </div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://blog.ikuamike.io/posts/2021/symfonos3/">
                <span class="button__icon">←</span>
                <span class="button__text">Vulnhub: Symfonos 3</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://blog.ikuamike.io/posts/2021/symfonos1/">
                <span class="button__text">Vulnhub: Symfonos 1</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>© Michael Ikua</span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://blog.ikuamike.io/assets/main.js"></script>
<script src="https://blog.ikuamike.io/assets/prism.js"></script>







  
</div>

</body>
</html>
