<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Cyberspace Kenya CTF: ZuluMeats3 :: ikuamike — CTFs :: InfoSec :: Hacking</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<<<<<<< HEAD
<meta name="description" content=""/>
=======
<meta name="description" content="Summary I recently worked on a CTF challenge by CyberSpace Kenya which I ended up winning. This is a writeup on how I solved the challenge. We were provided with an android app to reverse and submit 3 flags.
Flag 3 I haven&amp;rsquo;t done tons of mobile reverse engineering but as I was learning about the subject in previous challenges I found this 2-step approach to work well:
 Extracting the apk contents with apktool Reversing the app code with jadx-gui  Using apktool is pretty simple just run this command on the apk:"/>
>>>>>>> 4b8bec37001bc74f5e228cf8492191812e6bd57e
<meta name="keywords" content=", "/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://ikuamike.github.io/posts/2020/cyberspacectf-zulumeats3/" />


<link rel="stylesheet" href="https://ikuamike.github.io/assets/style.css">

  <link rel="stylesheet" href="https://ikuamike.github.io/assets/green.css">



<link rel="stylesheet" href="https://ikuamike.github.io/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://ikuamike.github.io/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="https://ikuamike.github.io/img/favicon/green.png">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Cyberspace Kenya CTF: ZuluMeats3 :: ikuamike — CTFs :: InfoSec :: Hacking" />
<<<<<<< HEAD
<meta name="twitter:description" content="" />
=======
<meta name="twitter:description" content="Summary I recently worked on a CTF challenge by CyberSpace Kenya which I ended up winning. This is a writeup on how I solved the challenge. We were provided with an android app to reverse and submit 3 flags.
Flag 3 I haven&amp;rsquo;t done tons of mobile reverse engineering but as I was learning about the subject in previous challenges I found this 2-step approach to work well:
 Extracting the apk contents with apktool Reversing the app code with jadx-gui  Using apktool is pretty simple just run this command on the apk:" />
>>>>>>> 4b8bec37001bc74f5e228cf8492191812e6bd57e
<meta name="twitter:site" content="https://ikuamike.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Cyberspace Kenya CTF: ZuluMeats3 :: ikuamike — CTFs :: InfoSec :: Hacking">
<<<<<<< HEAD
<meta property="og:description" content="" />
=======
<meta property="og:description" content="Summary I recently worked on a CTF challenge by CyberSpace Kenya which I ended up winning. This is a writeup on how I solved the challenge. We were provided with an android app to reverse and submit 3 flags.
Flag 3 I haven&amp;rsquo;t done tons of mobile reverse engineering but as I was learning about the subject in previous challenges I found this 2-step approach to work well:
 Extracting the apk contents with apktool Reversing the app code with jadx-gui  Using apktool is pretty simple just run this command on the apk:" />
>>>>>>> 4b8bec37001bc74f5e228cf8492191812e6bd57e
<meta property="og:url" content="https://ikuamike.github.io/posts/2020/cyberspacectf-zulumeats3/" />
<meta property="og:site_name" content="Cyberspace Kenya CTF: ZuluMeats3" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2020-06-12 00:00:00 &#43;0000 UTC" />











</head>
<body class="">


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    &gt; cd ~
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About Me</a></li>
        
      
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About Me</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://ikuamike.github.io/posts/2020/cyberspacectf-zulumeats3/">Cyberspace Kenya CTF: ZuluMeats3</a></h1>
  <div class="post-meta">
      
    <span class="post-date">
      2020-06-12
    </span>
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://ikuamike.github.io/tags/cyberspace/">Cyberspace</a>&nbsp;
    
    #<a href="https://ikuamike.github.io/tags/ctf/">CTF</a>&nbsp;
    
    #<a href="https://ikuamike.github.io/tags/android/">Android</a>&nbsp;
    
    #<a href="https://ikuamike.github.io/tags/reversing/">Reversing</a>&nbsp;
    
  </span>
  

  

  <div class="post-content">
    <h1 id="summary">Summary</h1>
<p>I recently worked on a CTF challenge by <a href="https://twitter.com/CyberSpaceKenya">CyberSpace Kenya</a> which I ended up winning. This is a writeup on how I solved the challenge. We were provided with an android app to reverse and submit 3 flags.</p>
<h2 id="flag-3">Flag 3</h2>
<p>I haven&rsquo;t done tons of mobile reverse engineering but as I was learning about the subject in previous challenges I found this 2-step approach to work well:</p>
<ul>
<li>Extracting the apk contents with apktool</li>
<li>Reversing the app code with jadx-gui</li>
</ul>
<p>Using apktool is pretty simple just run this command on the apk:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">&gt; apktool d cyberspace-ctf.apk
</code></pre></div><p>This generates files in a folder cyberspace-ctf as below:</p>
<pre><code>.
├── AndroidManifest.xml
├── apktool.yml
├── assets
├── lib
├── original
├── res
├── smali
└── unknown
</code></pre><p>Checking the AndroidManifest.xml and res/values/strings.xml doesn&rsquo;t reveal any flag. Usually grepping recursively through the apk files for interesting names would hint at something. After a few tries with the words flag, flag1, flag2, flag3 I got some interesting output.</p>

  <img src="/img/cyberspacectf/cyberspacectf1.png"  alt="cyberspacectf"  class="center"  style="border-radius: 8px;"  />


<p>Without much thought I opened jadx to find more mentions of that ValidateFlag3 and found the code.</p>

  <img src="/img/cyberspacectf/cyberspacectf2.png"  alt="cyberspacectf"  class="center"  style="border-radius: 8px;"  />


<p>Reading through the code I was able to figure out that the validate function does the following:</p>
<ol>
<li>takes our input</li>
<li>xor encrypts with a key(which is generated with getKey() function)</li>
<li>base64 encodes it</li>
<li>compares if it is equal to the hardcoded flag3.</li>
</ol>
<p>From previous experience I know that with xor encryption if you have the key and the encrypted data getting the plain text output is simple. Let me illustrate:</p>
<pre><code>encrypted = key ^ plaintext
plaintext = key ^ encrypted
</code></pre><p>Getting the code to work in java isn&rsquo;t as easy so I decided to use python and script the solution.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> base64

key1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hUZAf9gFIARRFTAvKRDs8A==&#34;</span>
key2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gp9jPELztMsd51Ih81gO0Q==&#34;</span>
flag3 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;RJ9qOOqa7pAinT19vyuQRHOGSi3FnPW5La0BYb4tnw==&#34;</span>

data1 <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(key1)
data2 <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(key2)
key <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(data2)):
    key<span style="color:#f92672">.</span>append(data1[i] <span style="color:#f92672">^</span> data2[i])

decodedflag <span style="color:#f92672">=</span> []
input <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(flag3)
encryptedFlag <span style="color:#f92672">=</span> input

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(encryptedFlag)):
    decodedflag<span style="color:#f92672">.</span>append(encryptedFlag[i] <span style="color:#f92672">^</span> key[i <span style="color:#f92672">%</span> len(key)])

b <span style="color:#f92672">=</span> [chr(s) <span style="color:#66d9ef">for</span> s <span style="color:#f92672">in</span> decodedflag]

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(b))
</code></pre></div><p>Flag 3: <code>CFI{plz_no_secret_in_java_code}</code></p>
<p>Since I found flag3 first I must have missed some stuff.</p>
<h2 id="flag-1">Flag 1</h2>
<p>Refering back to my earlier screenshot after performing the grep there&rsquo;s some base64 encoded data which I should have been more keen to look at!</p>
<p>base64: <code>Q1NfS0V7YmFzZTY0X2VuY29kaW5nX2lzX25vdF90aGF0X3NlY3VyZX0=</code></p>
<p>Flag 1: <code>CS_KE{base64_encoding_is_not_that_secure}</code></p>
<h2 id="flag-2">Flag 2</h2>
<p>Now flag 2 was the last to find. Since most of the clues we have been finding were in that since <code>assets/index.android.bundle</code> file let me have a look at it.</p>
<p>Something I noted was that jadx didn&rsquo;t find this file, that why the approach to use two tools is good IMO. There is a lot of code in this file that is not easily readable, so I just googled what this file is.</p>

  <img src="/img/cyberspacectf/cyberspacectf3.png"  alt="cyberspacectf"  class="center"  style="border-radius: 8px;"  />


<p>I found that this file contains minified-javascript it is created when an android app is coded using react, we saw mentions of react when reading the code in jadx.</p>
<p>Reading the code in it&rsquo;s minified form isn&rsquo;t easy so js-beautifier to the rescue. I then opened the readable version in vs code and searched for the validateflag function again.</p>
<p>I landed here and we can clearly see the function that contained the base64 and the the other one that called flag3, due to their order flag 2 is what is left.</p>

  <img src="/img/cyberspacectf/cyberspacectf4.png"  alt="cyberspacectf"  class="center"  style="border-radius: 8px;"  />


<p>I took the same approach to porting the code to python as it is easier for me to work with. I had to do a bit of googling to understand the js flow but came up with this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f</span>(n):
    t <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
    r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    e <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> range(len(n)):
        <span style="color:#66d9ef">if</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;</span> r:
            t <span style="color:#f92672">+=</span> <span style="color:#ae81ff">13</span>
        <span style="color:#66d9ef">else</span>:
            t <span style="color:#f92672">-=</span> len(n) <span style="color:#f92672">%</span> <span style="color:#ae81ff">9</span>
        u <span style="color:#f92672">=</span> ord(n[r]) <span style="color:#f92672">+</span> t
        e<span style="color:#f92672">.</span>append(str(u))
    <span style="color:#66d9ef">return</span> e
</code></pre></div><p>At the end, the output of the function is checked if it is equal to that list of numbers which is a hex representation of characters. Instead of trying to undo the transformation that was going on in the function where they add 13&hellip; which I tried did for a few hours and failed, better to bruteforce all possibilities.</p>
<p>I came up with this script for that:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> string

k <span style="color:#f92672">=</span> [<span style="color:#ae81ff">64</span>,<span style="color:#ae81ff">80</span>,<span style="color:#ae81ff">78</span>,<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">124</span>,<span style="color:#ae81ff">124</span>,<span style="color:#ae81ff">123</span>,<span style="color:#ae81ff">151</span>,<span style="color:#ae81ff">144</span>,<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">134</span>,<span style="color:#ae81ff">166</span>,<span style="color:#ae81ff">146</span>,<span style="color:#ae81ff">158</span>,<span style="color:#ae81ff">148</span>,<span style="color:#ae81ff">172</span>,<span style="color:#ae81ff">158</span>,<span style="color:#ae81ff">192</span>,<span style="color:#ae81ff">166</span>,<span style="color:#ae81ff">197</span>,<span style="color:#ae81ff">176</span>,<span style="color:#ae81ff">204</span>,<span style="color:#ae81ff">190</span>,<span style="color:#ae81ff">210</span>,<span style="color:#ae81ff">209</span>,<span style="color:#ae81ff">201</span>,<span style="color:#ae81ff">206</span>,<span style="color:#ae81ff">229</span>,<span style="color:#ae81ff">204</span>,<span style="color:#ae81ff">232</span>,<span style="color:#ae81ff">228</span>,<span style="color:#ae81ff">246</span>,<span style="color:#ae81ff">220</span>,<span style="color:#ae81ff">253</span>,<span style="color:#ae81ff">234</span>,<span style="color:#ae81ff">245</span>,<span style="color:#ae81ff">258</span>,<span style="color:#ae81ff">268</span>,<span style="color:#ae81ff">250</span>,<span style="color:#ae81ff">262</span>,<span style="color:#ae81ff">282</span>]

all <span style="color:#f92672">=</span> string<span style="color:#f92672">.</span>printable

a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">41</span>
flag <span style="color:#f92672">=</span> [a[i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(a))]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f</span>(n):
    t <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
    r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    e <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> range(len(n)):
        <span style="color:#66d9ef">if</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;</span> r:
            t <span style="color:#f92672">+=</span> <span style="color:#ae81ff">13</span>
        <span style="color:#66d9ef">else</span>:
            t <span style="color:#f92672">-=</span> len(n) <span style="color:#f92672">%</span> <span style="color:#ae81ff">9</span>
        u <span style="color:#f92672">=</span> ord(n[r]) <span style="color:#f92672">+</span> t
        e<span style="color:#f92672">.</span>append(str(u))
    <span style="color:#66d9ef">return</span> e

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(flag)):
    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(len(all)):
        flag[i] <span style="color:#f92672">=</span> all[j]
        out <span style="color:#f92672">=</span> f(flag)
        <span style="color:#66d9ef">if</span> out[i] <span style="color:#f92672">==</span> str(k[i]):
            <span style="color:#66d9ef">break</span>
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(flag))
</code></pre></div><p>Flag 2: <code>CFI{obfuscated_javascript_is_not_secured}</code></p>
<h1 id="conclusion">Conclusion</h1>
<p>This was a good ctf for practising some code review. I also had never played around with an app made with react so that was something I learnt.</p>
<p>I&rsquo;d like to thank the CyberSpace Kenya team for putting up the challenge as well <a href="https://twitter.com/ZuluMeats">ZuluMeats</a> for the prize.. You can find more challenges on their website: <a href="https://ctf.cyberspace.co.ke">https://ctf.cyberspace.co.ke</a></p>
<p>For any questions you can reach me on Twitter.</p>
<p>Twitter: <a href="https://twitter.com/ikuamike">ikuamike</a></p>
<p>Github: <a href="https://github.com/ikuamike">ikuamike</a></p>
<<<<<<< HEAD
=======

>>>>>>> 4b8bec37001bc74f5e228cf8492191812e6bd57e
  </div>
  
  <div class="pagination">
    <div class="pagination__title">
      <span
        class="pagination__title-h">Read other posts</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      
      <span class="button next">
        <a href="https://ikuamike.github.io/posts/2020/bitlab-htb/">
          <span class="button__text">Hack The Box: Bitlab</span>
          <span class="button__icon">→</span>
        </a>
      </span>
      
    </div>
  </div>
  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>© Michael Ikua</span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://ikuamike.github.io/assets/main.js"></script>
<script src="https://ikuamike.github.io/assets/prism.js"></script>





  
</div>

</body>
</html>
