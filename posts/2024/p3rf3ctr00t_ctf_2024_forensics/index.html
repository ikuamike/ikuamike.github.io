<!doctype html><html lang=en><head><title>P3RF3CT R00T CTF 2024 Writeup - Forensics ::</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Introduction This weekend I had some fun participating in the P3RF3CTR00T CTF 2024 by p3rf3ctr00t ctf team.
This is my second writeup, I&amp;rsquo;ll cover the forensics category specifically how I solved the Streams and Secrets set. I am not really that into forensics but I had to give it a try to score some points, I also got first blood on some of them. I was going solo in this CTF under NoPwnNoGain."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.ikuamike.io/posts/2024/p3rf3ctr00t_ctf_2024_forensics/><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-202973704-2","auto"),ga("send","pageview"))</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.ikuamike.io/img/p3rf3ctr00t_ctf_2024/ctf_logo.jpg"><meta name=twitter:title content="P3RF3CT R00T CTF 2024 Writeup - Forensics"><meta name=twitter:description content="Introduction This weekend I had some fun participating in the P3RF3CTR00T CTF 2024 by p3rf3ctr00t ctf team.
This is my second writeup, I&rsquo;ll cover the forensics category specifically how I solved the Streams and Secrets set. I am not really that into forensics but I had to give it a try to score some points, I also got first blood on some of them. I was going solo in this CTF under NoPwnNoGain."><meta name=twitter:site content="@ikuamike"><link rel=stylesheet href=https://blog.ikuamike.io/styles.css><link rel=stylesheet href=https://blog.ikuamike.io/css/style.css><link rel="shortcut icon" href=https://blog.ikuamike.io/img/theme-colors/green.png><link rel=apple-touch-icon href=https://blog.ikuamike.io/img/theme-colors/green.png><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="P3RF3CT R00T CTF 2024 Writeup - Forensics"><meta property="og:description" content="Introduction This weekend I had some fun participating in the P3RF3CTR00T CTF 2024 by p3rf3ctr00t ctf team.
This is my second writeup, I&amp;rsquo;ll cover the forensics category specifically how I solved the Streams and Secrets set. I am not really that into forensics but I had to give it a try to score some points, I also got first blood on some of them. I was going solo in this CTF under NoPwnNoGain."><meta property="og:url" content="https://blog.ikuamike.io/posts/2024/p3rf3ctr00t_ctf_2024_forensics/"><meta property="og:site_name" content><meta property="og:image" content="https://blog.ikuamike.io/img/p3rf3ctr00t_ctf_2024/ctf_logo.jpg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2024-11-17 12:17:45 +0300 +0300"></head><div id=particles-js></div><body class=green><div class="container center headings--one-size" style=background:#1f222a;z-index:1><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>> cd ~</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About Me</a></li><li><a href=/all-posts>All Posts</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://blog.ikuamike.io/posts/2024/p3rf3ctr00t_ctf_2024_forensics/>P3RF3CT R00T CTF 2024 Writeup - Forensics</a></h1><div class=post-meta><time class=post-date>2024-11-17 ::</time></div><span class=post-tags>#<a href=https://blog.ikuamike.io/tags/ctf/>CTF</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/forensics/>Forensics</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/master-file-table/>Master File Table</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/mft/>MFT</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/mftecmd/>MFTECmd</a>&nbsp;
#<a href=https://blog.ikuamike.io/tags/mft-explorer/>MFT Explorer</a>&nbsp;</span><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#part-1>Part 1</a></li><li><a href=#part-2>Part 2</a></li><li><a href=#part-3>Part 3</a></li><li><a href=#part-4>Part 4</a></li><li><a href=#part-5>Part 5</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#extras>Extras</a></li></ul></nav></div><img src=https://blog.ikuamike.io/img/p3rf3ctr00t_ctf_2024/ctf_logo.jpg class=post-cover alt="P3RF3CT R00T CTF 2024 Writeup - Forensics" title="Cover Image"><div class=post-content><div><h2 id=introduction>Introduction<a href=#introduction class=hanchor arialabel=Anchor>&#8983;</a></h2><p>This weekend I had some fun participating in the P3RF3CTR00T CTF 2024 by <a href=https://twitter.com/p3rf3ctr00t target=_blank rel=noopener>p3rf3ctr00t</a>
ctf team.</p><p>This is my second writeup, I&rsquo;ll cover the forensics category specifically how I solved the <strong>Streams and Secrets</strong> set. I am not really that into forensics but I had to give it a try to score some points, I also got first blood on some of them. I was going solo in this CTF under <strong>NoPwnNoGain</strong>.</p><h2 id=part-1>Part 1<a href=#part-1 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>We start of with the challenge info.</p><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_1.png class=center style=border-radius:8px><p>We are given 2 files, a script and the challenge artifact which we can download from the dump link.</p><p>This first one was easy to solve, I just got strings from the artifact.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>strings -30 <span style=color:#ae81ff>\$</span>MFT.copy0
</span></span></code></pre></div><p>The only user I saw in the output that made sense was analyst so this was the flag.</p><p>Flag: <code>r00t{Analyst}</code></p><h2 id=part-2>Part 2<a href=#part-2 class=hanchor arialabel=Anchor>&#8983;</a></h2><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_4.png class=center style=border-radius:8px><p>Here I faced a bit of a challenge since I couldn&rsquo;t work with this file on linux anymore. Based on the strings, it was clear I needed to use Windows.</p><p>I also did a lot of googling around what MFT. I found this resource <a href=https://aboutdfir.com/toolsandartifacts/windows/mft-explorer-mftecmd/ target=_blank rel=noopener>https://aboutdfir.com/toolsandartifacts/windows/mft-explorer-mftecmd/</a>
that guided me on the using MFTECmd and MFT Explorer.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps data-lang=ps><span style=display:flex><span> <span style=color:#a6e22e>.\MFTECmd.exe</span> <span style=color:#a6e22e>-f</span> <span style=color:#a6e22e>&#39;.\$MFT.copy0&#39;</span> <span style=color:#a6e22e>--csv</span> <span style=color:#a6e22e>.</span>
</span></span></code></pre></div><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_2.png class=center style=border-radius:8px><p>With the csv extracted, we can through the information. I applied a filter on the filename to only show filenames with the name secret.</p><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_3.png class=center style=border-radius:8px><p>We can see we have two last modified columns, I used the most latest of the two.</p><p>Flag: <code>r00t{2024-10-07_21:52:47}</code></p><h2 id=part-3>Part 3<a href=#part-3 class=hanchor arialabel=Anchor>&#8983;</a></h2><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_5.png class=center style=border-radius:8px><p>This was only solvable after getting the original contents of the secret.txt file. So we needed the encryption key as well as the contents of the file. From the awesomeScript.py we know the encryption function.</p><p>Using MFTECmd, we need to get the EntryNumber and SequenceNumber to dump the details.</p><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_6.png class=center style=border-radius:8px><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps data-lang=ps><span style=display:flex><span><span style=color:#a6e22e>.\MFTECmd.exe</span> <span style=color:#a6e22e>-f</span> <span style=color:#a6e22e>&#39;.\$MFT.copy0&#39;</span> <span style=color:#a6e22e>--de</span> <span style=color:#a6e22e>107744-3</span>
</span></span></code></pre></div><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_7.png class=center style=border-radius:8px><p>We now have the contents of secrets.txt and the encryption_key that was stored in the alternate data stream. This was already indicated in the csv output.</p><p>MFT Explorer could have also been used, it gives a nice GUI experience but is quite slow. This is also something highlighted in the resource I found, so be patient when you first load the MFT file into MFT Explorer.</p><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_8.png class=center style=border-radius:8px><p>MFT Explorer can give us all the data at one glance.</p><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_9.png class=center style=border-radius:8px><p>With the key we can craft our decode script as below and get the original contents of secrets.txt</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> cryptography.fernet <span style=color:#f92672>import</span> Fernet
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;MVJhfcwOV33RxMzyF1H6J9X5IVbyfzHbVHMqXP6HN7Q=&#39;</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;gAAAAABnBFRI3Z3tfxy7hD4tfW_8Lkd4hwFOXxGkguaty3Z2zTzehVjBZhs9Q57y8g--0rTvkaZw44o-Nc0NxLFHqEYPiLab0FYXf7Y-34Rz27tKq_IFClITfXafCFR5BQb07PawxhP-&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>f <span style=color:#f92672>=</span> Fernet(key)
</span></span><span style=display:flex><span>encrypted_message <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>decrypt(message<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>print(str(encrypted_message,<span style=color:#e6db74>&#34;utf-8&#34;</span>))
</span></span></code></pre></div><p>Once decoded, we get the following.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>secret={M4st3r_F1l3_t4bl3_1n_ntfs}
</span></span></code></pre></div><p>Since it&rsquo;s a txt file, the size will be equal to the size of the text which in this case is 34.</p><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_10.png class=center style=border-radius:8px><p>If we create the file locally, linux shows the size as 34.</p><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_14.png class=center style=border-radius:8px><p>Flag: <code>r00t{34}</code></p><p>Based on the solves of the next challenges, seems the decryption was the biggest hurdle.</p><h2 id=part-4>Part 4<a href=#part-4 class=hanchor arialabel=Anchor>&#8983;</a></h2><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_11.png class=center style=border-radius:8px><p>We already have the encryption key from the previous step.</p><p>Flag: <code>r00t{MVJhfcwOV33RxMzyF1H6J9X5IVbyfzHbVHMqXP6HN7Q=}</code></p><h2 id=part-5>Part 5<a href=#part-5 class=hanchor arialabel=Anchor>&#8983;</a></h2><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_12.png class=center style=border-radius:8px><p>Flag: <code>r00t{M4st3r_F1l3_t4bl3_1n_ntfs}</code></p><h2 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>&#8983;</a></h2><p>I definitely learnt a thing or two here about forensics on the Master File Table (MFT). Cheers to the author <a href=https://x.com/festusgichohi1 target=_blank rel=noopener>boynamedboy</a></p><h2 id=extras>Extras<a href=#extras class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Seems the intended path for part 3 (According to the author) was just focusing on the info from MFTECmd or MFT Explorer and getting the logical size. I completely missed that detail, I just assumed it&rsquo;s the original size of the file.</p><img src=/img/p3rf3ctr00t_ctf_2024/streams_and_secrets_13.png class=center style=border-radius:8px><p>0x22 is 34 in Decimal.</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://blog.ikuamike.io/posts/2024/p3rf3ctr00t_ctf_2024_ad/><span class=button__text>P3RF3CT R00T CTF 2024 Writeup - Active Directory</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div><script src=/js/vanilla-back-to-top.min.js></script>
<script>addBackToTop({diameter:40,backgroundColor:"rgb(120, 226, 160)",textColor:"#1F222A",cornerOffset:30})</script><script src=/js/particles.min.js></script>
<script>particlesJS("particles-js",{particles:{number:{value:80,density:{enable:!0,value_area:1e3}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"}},opacity:{value:.5,random:!1,anim:{enable:!1,speed:1,opacity_min:.1,sync:!1}},size:{value:2,random:!0,anim:{enable:!1,speed:4,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ffffff",opacity:.3,width:1},move:{enable:!0,speed:.5,direction:"none",random:!0,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},retina_detect:!0})</script></body></html>